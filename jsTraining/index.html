<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
<title>JoynMe Widget</title>
<meta charset="utf-8">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<meta name="viewport" content="user-scalable=yes,width=device-width"/>


<meta name="author" content="JoynMe, Inc.">
<meta name="apple-itunes-app" content="app-id=487087882"/> <!--smart banner stuff for iOS-->
<meta name="google-play-app" content="app-id=com.joynme.joynme.prod">
<link rel="stylesheet" href="css/jquery.smartbanner.css" type="text/css" media="screen">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="stylesheet" href="bootstrap/css/bootstrap.css"/>
<link rel="stylesheet" href="css-social-buttons/css/zocial.css"/>
<link rel="stylesheet" href="css/widget-CSS.css"/>
<link rel="stylesheet" href="css/token-input-facebook.css"/>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css"/>
<link rel="stylesheet" href="eggplantCss/timePicker.css"/>
<link rel="stylesheet" href="css/autoSuggest.css"/>
<link rel="stylesheet" href="css/jquery-ui-timepicker-addon.css"/>
<link rel="stylesheet" href="css/jquery-calendar.css">
<!--
<script src="http://code.jquery.com/jquery-latest.js"></script>
-->
<script type="text/javascript" src="js/jquery.1.8.3-min.js"></script>
<script type="text/javascript" src="http://code.jquery.com/ui/1.9.1/jquery-ui.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-timepicker-addon.js"></script>
<script type="text/javascript" src="js/jquery-ui-sliderAccess.js"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script type="text/javascript" src="js/base64.js"></script>
<script type="text/javascript" src="js/geoIpWrapper.js"></script>
<script type="text/javascript" src="js/api.js"></script>



<script type="text/javascript" src="js/joynmeLogIn.js"></script>
<script type="text/javascript" src="js/jquery-calendar.js"></script>
<script type="text/javascript" src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
<script type="text/javascript" src="js/jQuery.XDomainRequest.js"></script>
<script type="text/javascript" src="bootstrap/js/bootstrap.js"></script>
<script type="text/javascript"src="http://maps.googleapis.com/maps/api/js?key=AIzaSyAz_GOaRx71JwN03eRHTbZhLhdm1N_5ed8&amp;sensor=true"></script>
<script type="text/javascript" src="js/gmap3.js"></script>
<script type="text/javascript" src="js/gmail/gmail.js"></script>

<script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>

<script type="text/javascript" src="js/userInteraction.js"></script>
<script type="text/javascript" src="js/strophe.min.js"></script>
<script type="text/javascript" src="js/main.js"></script>
<script type="text/javascript" src="js/jquery.timePicker.js"></script>
<script type="text/javascript" src="screenManagerV2.js"></script>
<script type="text/javascript" src="js/date.js"></script>
<script type="text/javascript" src="js/jquery.autoSuggest.js"></script>
<script type="text/javascript" src="js/facebook/facebook.js"></script>
<script type="text/javascript" src="js/twitter/twitter.js"></script>
<script type="text/javascript" src="js/joynmeGoogleMap.js"></script>
<script type="text/javascript" src="js/joynmeToolTip.js"></script>
<script type="text/javascript" src="js/SHA1.js"></script>
<script type="text/javascript" src="js/cookieNotification.js"></script>
<script type="text/javascript" src="js/json2.js"></script>


<style>
    body {
        overflow-x: hidden;
    }
</style>
<script type="text/javascript">




 // Layers Window Managers
var eventWindowManager;
var notificationWindowManager;
var agendaWindowManager;
var createActivityWindowManager;
var favoritesWindowManager;
var groupsWindowManager;
var createGroupWindowManager;
var accountSettingWindowManager;
var findAgroupWindowManager;

$(document).ready(function () {
    //
    //showSignUpScreen();

    // check size
    $('#windowSize').html('<div class="alert"> Window Size: ' + $(window).width() + 'px</div>');
    $('#stageSize').html('<div class="alert">Stage Size: ' + $("#stage").width() + 'px</div>');
    $('#sideMenuSize').html('<div class=" alert alert-info"> Side Menu Size: ' + $("#sideMenu").width() + 'px</div>');

    // start of window manager for the stage
    var marginValue = "";
    var currentMarginValue;
    //var eventListScreen = new ListViewScreen();
    var eventListScreen = new ListViewActivitiesScreen();
    var eventDetailScreen = new DetailsScreen();
    var eventChatRoom = new ChatScreen();
    var eventOtherScreen = new InfoWindow();
    var notificationListScreen = new ListViewNotificationScreen();
    var notificationDetailScreen = new DetailsScreen();
    var notificationChatRoom = new ChatScreen();
    var notificationOtherScreen = new InfoWindow();
    var agendaListScreen = new ListViewAgendaScreen();
    var agendaDetailScreen = new DetailsScreen();
    var agendaChatRoom = new ChatScreen();
    var agendaOtherScreen = new InfoWindow();
    var createActivityStepOne = new CreateActivityStepOne();
    var createActivityStepTwo = new CreateActivityStepTwo();
    var manageFavoritesScreen = new ManageFavoritesScreen();
    var addFavoritesScreen = new AddFavoritesScreen();
    var groupsListScreen = new ListViewGroupsScreen();
    var groupDetailScreen = new GroupDetailsScreen();
    var groupActivitiesListScreen = new GroupActivitiesListViewScreen();
    var groupActivitiesDetailScreen = new GroupActivitiesDetailsScreen();
    var groupActivitiesChatScreen = new ChatScreen();
    var FgroupDetailScreen = new GroupDetailsScreen();
    var FgroupActivitiesListScreen = new GroupActivitiesListViewScreen();
    var FgroupActivitiesDetailScreen = new GroupActivitiesDetailsScreen();
    var FgroupActivitiesChatScreen = new ChatScreen();
    var createAGroupStepOneScreen = new CreateAGroupStepOne();
    var createAGroupStepTwoScreen = new CreateAGroupStepTwo();
    var accountSettingScreen = new AccountSettingScreen();
    var findAgroupScreen = new FindAGroup();
    //var groupMembersScreen = new InfoWindow();

    eventWindowManager = new WindowManager();
    notificationWindowManager = new WindowManager();
    agendaWindowManager = new WindowManager();
    createActivityWindowManager = new WindowManager();
    favoritesWindowManager = new WindowManager();
    groupsWindowManager = new WindowManager();
    createGroupWindowManager = new WindowManager();
    accountSettingWindowManager = new WindowManager();
    findAgroupWindowManager = new WindowManager();

    var widthToToggle = "";
    var marginToAdd = 0;
    var screenWidth = 0;
    var planSliderMargin = 0;


    eventWindowManager.push(eventListScreen, eventDetailScreen, eventChatRoom, eventOtherScreen);
    notificationWindowManager.push(notificationListScreen, notificationDetailScreen, notificationChatRoom, notificationOtherScreen);
    agendaWindowManager.push(agendaListScreen, agendaDetailScreen, agendaChatRoom, agendaOtherScreen);
    createActivityWindowManager.push(createActivityStepOne, createActivityStepTwo);
    favoritesWindowManager.push(manageFavoritesScreen, addFavoritesScreen);
    groupsWindowManager.push(groupsListScreen, groupDetailScreen, groupActivitiesListScreen, groupActivitiesDetailScreen, groupActivitiesChatScreen);
    createGroupWindowManager.push(createAGroupStepOneScreen, createAGroupStepTwoScreen);
    accountSettingWindowManager.push(accountSettingScreen);
    findAgroupWindowManager.push(findAgroupScreen, FgroupDetailScreen, FgroupActivitiesListScreen, FgroupActivitiesDetailScreen, FgroupActivitiesChatScreen);


    // console.log(" Window Manager Stack: " + JSON.stringify(createActivityWindowManager.stack));
    renderScreens();
    // initialize tooltip

    var sortActivitiesHtml = "<div class='row-fluid'><div style='margin-bottom: 5px' class='btn-group' data-toggle='buttons-radio'> <button id='getAllEvents' type='button' class='btn btn-medium'><i class='icon-ok-sign'></i> All </button> " +
            "<button id='getListFavorites' type='button' class='btn btn-medium'><i class='icon-star'></i> Favorites </button> </div>" + "<div class='btn-group span12' data-toggle='buttons-radio'>" +
            "<button id='getListByDistance' type='button' class='btn '><i class='icon-road'></i>Distance</button><button id='getListByTime' type='button' class='btn active'>" +
            "<i class='icon-time'></i>Time</button></div></div>";
    var publicPrivateTipHtml = "<h1>Public VS Private</h1><p> Setting your activity to public opens the activity to all JoynMe members.</p>" +
            "<p>Setting your activity to private means only the friends you invite can come to your activity.</p>";
    var createActivityTypeHtml = "<p style='font-size: 13pt'>Add activity type you would like to plan</p><form><input class='span12' type='text' placeHolder='activity type' id='activityTypeInput' />" +
            "<div><input  id='addActivityType' type='button' class='btn btn-primary' value='Add Activity'>" +
            "<input id='cancelActivityType' type='button' class='btn' value='Cancel' style='margin-left: 5px'></div></form>";

    var t = new T('sortActivitiesBtn', sortActivitiesHtml, 'eventLayerList');
    var t2 = new T('createActivityInfo', publicPrivateTipHtml, 'createActivityLayerList');
   // var t3 = new T('addNewActivityBtn', createActivityTypeHtml, 'createActivityLayerList');

    // var t4 = new T('planBtn', "<h1> Creating The Activity ...</h1>" , 'widget');

    t.showToolTip('click');
    $(".modal").css('width', getScreenWidth());
    //
    $(".MapPopHandler").live('click', function () {
        $('#createActivityMapPop').removeClass('noVisibility').modal('show');
    });

    // alert($(".modal").width());


    //image upload
    $("#ComGroupImgUpload").submit(function(event) {
        var dados = $( form ).serialize();
        $.ajax({
            type: "POST",
            contentType:attr( "enctype", "multipart/form-data" ),
            url: "<?php echo site_url(); ?>adm/oferta_insert",
            data: dados,
            success: function( data )
            {
                alert( data );
            }
        });

        return false;
    });

    $(window).resize(function () {
       // renderWhenResizing();
        //eventWindowManager.setStageWidth();
        //eventWindowManager.setScreenWidth();
        // alert(eventWindowManager.screenWidth);
        google.maps.event.trigger(widget.map, "resize");
        widget.map.setCenter(userLocation.location);
        $('#windowSize').html('<div class="alert"> Window Size: ' + $(window).width() + 'px</div>');
        $('#stageSize').html('<div class="alert">Stage Size: ' + $("#stage").width() + 'px</div>');
        $('#paneSize').html('<div class="alert">Pane Size: ' + $(".screen").width() + 'px</div>');
        $('#sideMenuSize').html('<div class=" alert alert-info"> Side Menu Size: ' + $("#sideMenu").width() + 'px</div>');

    });
    function renderWhenResizing() {
        //eventWindowManager.stageWidth = $("#" + eventWindowManager.stageDivId).width();
        renderScreens();
        var viewPort = groupsWindowManager.viewType;
        console.log(" View Port: " + viewPort)
        if (viewPort != "oneScreen"){
            $('#sideMenu').css('width','127px').show();
        }
        console.log(" event Window Size: " + eventWindowManager.viewType);

    }

    function renderScreens() {
        eventWindowManager.render("eventLayer");
        notificationWindowManager.render("notificationLayer");
        agendaWindowManager.render("agendaLayer");
        createActivityWindowManager.render("createActivityLayer");
        favoritesWindowManager.render("favoritesLayer");
        groupsWindowManager.render("groupsLayer");
        createGroupWindowManager.render("createGroupLayer");
        accountSettingWindowManager.render('accountSettingLayer');
        findAgroupWindowManager.render("findAgroupLayer");


        currentMarginValue = parseInt($("#" + groupsWindowManager.container + "LayerSlider").css("margin-left"));
        screenWidth = eventWindowManager.screenWidth;

        if (eventWindowManager.viewType == 'oneScreen') {
            // $("#sideMenu").hide();
            $(".sliderToggle").show();
            showActivitiesListScreen();
            var screenWidth = screenWidth;
            //alert("screen width : " + screenWidth);
            $("#welcomeMapLayer").css({
                'margin-left':0,
                'width':screenWidth + "px",
                'z-index':0
            });
            $(".btn-medium, .btn-small").removeClass("btn-medium btn-small").addClass("btn-mini");
            widthToToggle = 94;
            planSliderMargin = getScreenWidth();
            // marginToAdd = 14;


        }
        else if (eventWindowManager.viewType == 'dualScreen') {
            //alert(' duall screen');
            $("#sideMenu").show().css('width', '127px');
            showActivitiesListScreen();
            var screenWidth = getScreenWidth();
            //alert("screen width : " + screenWidth);
            $("#welcomeMapLayer").css({
                'margin-left':screenWidth,
                'width':screenWidth + "px"
            });
            $(".btn-medium, .btn-mini").removeClass("btn-medium btn-mini").addClass("btn-small");
            widthToToggle = 94 / 2;
            // marginToAdd = 14;
            planSliderMargin = getScreenWidth();

        }
        else {
            showActivitiesListScreen();
            var screenWidth = getScreenWidth();
            //alert("screen width : " + screenWidth);
            $("#welcomeMapLayer").css({
                'margin-left':screenWidth,
                'width':screenWidth * 2 + "px"
            });
            $(".btn-small, .btn-mini").removeClass("btn-small btn-mini").addClass("btn-medium");
            widthToToggle = 94 / 3;
            // marginToAdd = 14;
            planSliderMargin = getScreenWidth();

        }
        //   Show sign up if user did not log in
        setTimeout( function(){
            if (loggedIn == false) {
                (function() {
					// returns null if there is NOT a cookie based notification ready to be consumed
                    var result = detectNotificationCookie(false);
                    if (result == null){
                        printLoginBtn();
                        // <-- Wait for the DOM to be ready
                        // showSignUpScreen();                         // <-- Waiting an additional 1000ms
                    }

                })();
            }
        }, 1000);



        $('#windowSize').html('<div class="alert"> Window Size: ' + $(window).width() + 'px</div>');
        $('#stageSize').html('<div class="alert">Stage Size: ' + $("#stage").width() + 'px</div>');
        $('#paneSize').html('<div class="alert">Pane Size: ' + $(".screen").width() + 'px</div>');
        $('#sideMenuSize').html('<div class=" alert alert-info"> Side Menu Size: ' + $("#sideMenu").width() + 'px</div>');

        //alert(planSliderMargin);
    }

    //
    var activitiesListObject;

    function showActivitiesListScreen(selector) {
        //$("*").removeClass('newActivityHighlight');
        joynMeApiCall("GET", "event", JSON.stringify(queryString), function (localReturnedObject) {
            printEvents(localReturnedObject.eventList, "#eventsListContainer", 'event', 'time');
            activitiesListObject = localReturnedObject.eventList;
            populateMap( activitiesListObject, '#mapContainer');
           // console.log(JSON.stringify(activitiesListObject));
            initBinding();
        });

        $("#eventLayer").css('z-index', '2');
        $("#" + eventWindowManager.container + "List").animate({
            'margin-left':0
        }, function () {
            var $elem = $("#" + selector);
            $elem.addClass('newActivityHighlight');
            if ($elem.length > 0) {
                // $elem.removeClass('newActivityHighlight');
                var $container = $("#eventsListContainer");
                var scrollPos = $elem.offset().top - $container.offset().top;
                $container.animate({
                    scrollTop:scrollPos
                }, 700, function(){
                   // alert(' animation is done');
                    $elem.trigger('click');
                });
            }
        });

    }
    //


    // on click sign in with joynme
    $(document).on('click', '#signInWithJoynMe', function(){
        $("#createContainer").remove();
        //  $("#SignUpShadowBox").hide();
        $("#signUpContainer").show();

        if (!$(this).attr('data-toggled') || $(this).attr('data-toggled') == 'off'){
            /* currently it's not been toggled, or it's been toggled to the 'off' state,
             so now toggle to the 'on' state: */
            $(this).attr('data-toggled','on');
            $(".signInForm").slideDown();


            // and do something...
        }
        else if ($(this).attr('data-toggled') == 'on'){
            /* currently it has been toggled, and toggled to the 'on' state,
             so now turn off: */
            $(this).attr('data-toggled','off');
            $(".signInForm").slideUp();

            // and do, or undo, something...
        }
    });

    // facebook log Out
    $('body').on('click', "#logOutBtn", function(){
        //alert('fb log out');
       //doLogOut();
        //window.top.location.href= getPathFromUrl(window.top.location.href);
        cookieLogOut();
        //location.reload();
        fbLogout();
        showActivitiesListScreen();
        printLoginBtn();
        showSignUpScreen();

    });

    $('body').on('click', ".joynMeLogout", function(){
        cookieLogOut();
    });

    // click cancel edit event button
    $("#cancelEventEditBtn").live('click', function () {
        $('#editEventBtnTipContainer').hide();

        var stageWidth = $("#stage").width();
        $("#editEventScreen").animate({
            left:stageWidth
        }, function () {
            $('.TipShadowBox').fadeOut();
        })
    });


    // click cancel edit group button

    $("#cancelComGroupEditBtn").live('click', function () {
        $('#editComGroupBtnTipContainer').hide();
        $('#groupOptionsBtnTipContainer').hide();
        $('.TipShadowBox').fadeOut();
        var stageWidth = $("#stage").width();
        $("#editComGroupScreen").animate({
            left:stageWidth
        }, function () {
            $('.TipShadowBox').fadeOut();
        })
    });



    // edit a  event Buton
    $("#editEvent").live('click', function () {
        var currentEvent = $('body').data('currentEvent'); // current event
        var eventId = currentEvent.id;
        //alert(' evenId' + eventId);
        var eventStartTime = currentEvent.start;
        var eventActivityName = currentEvent.activityName;
        var eventEndTime = currentEvent.end;
        var eventNotes = currentEvent.notes;
        var eventLat = currentEvent.latitude;
        var eventLng = currentEvent.longitude;
        activityLocation.lng = eventLat;
        activityLocation.lat = eventLng;
        var eventPublicStatus = currentEvent.publicEvent;
        editPublicEvent = eventPublicStatus;
        var $closestLayerSlider = $(this).closest($('[id$="LayerSlider"]'));
        var detailScreenMargin = parseInt($closestLayerSlider.css("margin-left"));
        var screenWidth = $(".screen").width();
        var stageHeight = $("#stage").height();
        var stageWidth = $("#stage").width();
        var windowWidth = $(window).width();

        // alert( "Invite Process" );
        $("#editEventScreenLayer").remove();
        var eventUpdateHtml = "<div class='row-fluid'>" +
                "<div class='row-fluid'><h1> " + eventActivityName + "</h1></div>" +
                //"<div class='row-fluid'><div class='span6'> Start Date</div><div class='span6'> End Date</div></div>" +
                "<div class='row-fluid'><div class='span6'> <input type='text' id='editStartDateTime' class='dateAndTime span12 ' placeholder='Start Time'></div>" +
                "<div class='span6'> <input type='text' id='editEndDateTime' class='dateAndTime span12' placeholder='End Time'></div></div>" +
                "<div class='row-fluid'><div class='span12'><textarea id='editNotes' rows='5' class='span12' style='margin-top: 0px; margin-bottom: 2px; " +
                "height: 100px;' placeholder='Notes: (Remind people to bring equipment money for fees, or give them special directions or details about the activity location.'></textarea></div></div>" +
                "<div class='row-fluid'><h1> Location</h1></div>" +
                '<div class="row-fluid"><div class="span12"><div id="placeHolder"><a href="#" class="MapPopHandler"> <h1 style="position: absolute;left: 19%;line-height: 100px;font-size: 26px;color: black;">Choose a Location</h1>' +
                '<img id="dummyMap" src="images/map.png"></a></div><div class="chosenLocation"></div></div></div>' +
                "<div class='row-fluid centerAlign'><div class='span1'></div><div class='span10'><div class='btn-group span12' data-toggle='buttons-radio'>" +
                "<button type='button' id='editPublicBtn' class='btn span6 publicPrivateBtn'><i class='createActivityIcon publicIcon'></i>Public</button>" +
                "<button type='button' id='editPrivateBtn' class='btn span6 publicPrivateBtn'><i class='createActivityIcon privateIcon'></i>Private</button></div></div><div class='span1'></div></div>";
        var editEventContainer = "<div class='screenTopBar' style='position: relative;text-align: center'> " +
                "<span class='h1'> Edit Event</span><div class='backBtn'><span id='cancelEventEditBtn' class='btn-joynme btn span11' style='float: right; margin-top: 1px'> Cancel</span></div><div class='nextBtn'><span id='saveEventEditBtn' class='btn-joynme btn span11' style='float: right; margin-top: 1px'> Save</span>" +
                "</div></div><div id='eventEditContent'> " + eventUpdateHtml + "</div>";
        var editEventScreen = '<div id="editEventScreen" style="background-color: rgb(204,235,220 ); left:' + stageWidth + 'px;z-index: 999;position: absolute;top: 0px;height: ' + stageHeight + 'px ;width: ' + screenWidth + 'px " >' +
                editEventContainer + '</div>';
        var shadowBoxHtml = '<div class="TipShadowBox" style="position: absolute; top:0px; height: ' + stageHeight + 'px ;width: ' + windowWidth + 'px " ></div>';
        var editEventScreenLayer = "<div id='editEventScreenLayer'> " + shadowBoxHtml + editEventScreen + "</div>";
        $("#stage").append(editEventScreenLayer);
        $("#editEventScreen").animate({
            left:detailScreenMargin
        }, function () {
            //alert(" done animation");
            $("#editStartDateTime").val(convertDateToMDYT(eventStartTime));
            $("#editEndDateTime").val(convertDateToMDYT(eventEndTime));
            $("#editNotes").val(eventNotes);
            var chosenLocationAddress = $("#searchLocation").val();
            //$('#createActivityMapPop').modal('hide');
            //
            var location = new google.maps.LatLng(eventLat, eventLng);
            initializeMap(location, "placeHolder");
            $(".chosenLocation").html(chosenLocationAddress).append("<span class='badge badge-info MapPopHandler' style='margin-left: 5px'> Change location</span>");
            eventPublicStatus ?  $("#editPublicBtn").addClass('active') :  $("#editPrivateBtn").addClass('active');
            $(".dateAndTime").datetimepicker({
                controlType:'select',
                timeFormat:'hh:mm TT',
                showTime:false,
                stepMinute:15
            });
            $('.dateAndTime').attr("readonly", false);


        });
    });


    //edit a group!!!!!!!!!!!!

    $("#editComGroup").live('click', function () {
        if (!userIsAdmin){
            showMessageToUser("Only group admins can make edits!", "alert-error");
            $('#groupOptionsBtnTipContainer').hide();
        }else{

        var currentGroup = comGroupId;

        var $closestLayerSlider = $(this).closest($('[id$="LayerSlider"]'));
        var detailScreenMargin = parseInt($closestLayerSlider.css("margin-left"));
        var screenWidth = $(".screen").width();
        var stageHeight = $("#stage").height();
        var stageWidth = $("#stage").width();
        var windowWidth = $(window).width();
        var comGroupData = $('body').data('currentGroup');
        var comGroupName = comGroupData.name;
        var comGroupUrl = comGroupData.url;
        var comGroupDescription = comGroupData.description;
        var comGroupTerritory = comGroupData.territory;
        var comGroupPrivacy = comGroupData.privacy;
        if (comGroupPrivacy == 'PUBLIC'){
            var defaultToPublic = "active";
            var defaultToPrivate = "";
        }else{
            defaultToPrivate ="active";
            defaultToPublic = "";
        }
        if (comGroupPrivacy == 'PRIVATE_INVISIBLE'){
            var defaultToVisible = "";
            var defaultToInvisible = "active";
        }else{
            defaultToVisible ="active";
            defaultToPublic = "";
        }

        if(comGroupUrl.length == 1){
            comGroupUrl = "Website";
        }
        if(comGroupDescription.length == 1){
            comGroupDescription = "Group Description";
        }
        if(comGroupTerritory.length == 1){
            comGroupTerritory = "Territory";
        }
        $("#editComGroupScreenLayer").remove();

        var comGroupUpdateHtml = '<h1 style="padding:5px;">Group Details</h1><div class="span11 comGroupContainer"  id="comGroupDetail"><div class="row-fluid "> <div class="span2" ><span id="imageHolder"></span>' +
                '<form id="comgroupImgForm" >' +
                '<div id="fileHolder"><input class="placeImage" type="file" name="files[0]" id="comGroupImgFile" onchange="readURL(this)"></div></form></div> ' +
                '<div class="span10" style="border-left: solid 1px #868686"> <div class="span12" style="border-bottom: solid 1px #868686"> <input style="margin: 0px; border: none" type="text" class="span12" id="inputGroupName" placeHolder = "'+ comGroupName +'" /></div> ' +
                '<div class="span12" style="margin-left: 0px"> <input style="margin: 0px; border: none" type="text" class="span12 " placeHolder = "'+ comGroupUrl +'"   id="inputGroupUrl" /></div> </div> </div> <hr class="dHr">' +
                '<div class="row-fluid"> <div class="span12 "> <input style="margin: 0px; border: none" type="text" class="span12 "  placeHolder = "'+ comGroupTerritory +'" id="inputGroupTerritory"/></div> ' +
                '</div> <hr class="dHr"> <div class="row-fluid"><div class="span12" style="height: 103px;">' +
                '<textarea style="margin: 0px; border: none" id="inputGroupDescription" rows="5" class="span12" style="margin-top: 0px; margin-bottom: 0px; height: 90px;"  placeHolder = "'+ comGroupDescription +'"></textarea>' +
                '</div> </div> </div>'+

                '<div class="row-fluid" style="margin-top: 20px; margin-bottom: 5px"><span class="titleText"> Privacy Details</span><i class="createActivityIcon infoIcon" id="createGroupInfo" title="<h1>Public VS Private</h1>' +
                '</p>"></i></div><div class="comGroupContainer"> ' +
                '<div class="row-fluid padding10px"><div class="row-fluid centerAlign"><div class="span10" style="padding-left: 70px">' +
                '<div class="btn-group span12" data-toggle="buttons-radio"><button type="button" id="publicGroupBtn" class="btn span6 publicPrivateBtn '+defaultToPublic +' ">' +
                '<i class="createActivityIcon publicIcon"></i>Public</button><button type="button" id="privateGroupBtn" class="btn span6 publicPrivateBtn '+defaultToPrivate +'"><i class="createActivityIcon privateIcon"></i>Private</button>' +
                '<div class="clearfix"></div></div></div></div></div>' +
                ' <hr class="dHr"> <div class="row-fluid padding10px" data-toggle="buttons-radio"><button type="button" id="visibleGroupBtn" class="btn span6 visibleInvisibleBtn '+defaultToVisible +'">' +
                '<i class="createActivityIcon publicIcon"></i>Visible</button><button type="button" id="invisibleGroupBtn" class="btn span6 visibleInvisibleBtn '+defaultToInvisible +'"><i class="createActivityIcon privateIcon"></i>Invisible</button></div> </div>';

        var editComGroupContainer = "<div class='screenTopBar' style='position: relative;text-align: center'> " +
                "<span class='h1'> Edit Group</span><div class='backBtn'><span id='cancelComGroupEditBtn' class='btn-joynme btn span11' style='float: right; margin-top: 1px'> Cancel</span></div><div class='nextBtn'><span id='saveComGroupEditBtn' class='btn-joynme btn span11' style='float: right; margin-top: 1px'> Save</span>" +
                "</div></div><div id='comGroupEditContent'>"+ comGroupUpdateHtml +"</div>";
        var editComGroupScreen = '<div id="editComGroupScreen" style="background-color:#ccebdc; left:' + stageWidth + 'px;z-index: 999;position: absolute;top: 0px;height: ' + stageHeight + 'px ;width: ' + screenWidth + 'px " >' + editComGroupContainer +'</div>';
        var shadowBoxHtml = '<div class="TipShadowBox" style="position: absolute; top:0px; height: ' + stageHeight + 'px ;width: ' + windowWidth + 'px " ></div>';
        var editComGroupScreenLayer = "<div id='editComGroupScreenLayer'> " + shadowBoxHtml + editComGroupScreen + "</div>";
        $("#stage").append(editComGroupScreenLayer);
        $("#editComGroupScreen").animate({
            left:detailScreenMargin
        }, function () {

        });
      } //for the else to check for admin status
    });


    $("#deleteEvent").live('click', function () {
        var currentEvent = $('body').data('currentEvent'); // current event
        var eventId = currentEvent.id;
        var tokenO = {};
        tokenO.token = queryString.token;
        joynMeApiCall("DELETE",'event/id/'+ eventId +'/token/'+ tokenO.token +'', JSON.stringify(tokenO) , function(){
            $('#editEventBtnTipContainer').hide();
            $('.TipShadowBox').fadeOut();
            $('.getEvents').trigger('click');
            showMessageToUser('Activity deleted successfully', 'alert-success');

        });


    });



    // on click edit public/ private buttons
    $("body").on(' click ', '  #editPublicBtn ', function(){
       // alert(" public btn clicked");
        editPublicEvent = true;

    });
    $("body").on(' click ', '  #editPrivateBtn ', function(){
       // alert(" private btn clicked");
        editPublicEvent = false;

    });

    // update current event
      $("body").on(' click ', ' #saveEventEditBtn ', function(){
          $('#editEventBtnTipContainer').hide();


          var currentEventId = $('body').data('currentEvent').id;
          var o = {};
          o.token = queryString.token;
          o.event = {};
          o.event.start = new Date($("#editStartDateTime").val().replace('PM', '').replace('AM', '')).toString("yyyy-M-d HH:mm:ss");
          o.event.end   = new Date($("#editEndDateTime").val().replace('PM', '').replace('AM', '')).toString("yyyy-M-d HH:mm:ss");
          o.event.notes = $("#editNotes").val();
          o.event.latitude = activityLocation.lat ;
          o.event.longitude = activityLocation.lng;
          o.event.publicEvent = editPublicEvent;
         // alert(" Object : " + JSON.stringify(o));
          joynMeApiCall("PUT", 'event/id/' + currentEventId, JSON.stringify(o), function(){
              var stageWidth = $("#stage").width();
              showMessageToUser("Your activity has been updated!","alert-success");
              $("#editEventScreen").animate({
                  left:stageWidth
              }, function () {
                  $('.TipShadowBox').fadeOut();
                  $('#' + currentEventId).trigger('click');
              })
          })

      });


    // update current comgroup

    $("body").on('click', '#saveComGroupEditBtn', function(){
        var comGroupData = $('body').data('currentGroup');
        var vis = $("#visibleGroupBtn").hasClass('active'); // ? 'VISIBLE' : 'INVISIBLE'
        if (vis){
            vis = "VISIBLE";
        }else{
            vis = "INVISIBLE";
        }
        var o = {};
        o.token = queryString.token;
        o.comgroup = {};
        o.comgroup.name = $('#inputGroupName').attr('value');
        if(o.comgroup.name == ""){
            o.comgroup.name = comGroupData.name;
        }

        o.comgroup.description = $("#inputGroupDescription").attr('value');
        if(o.comgroup.description == ""){
            o.comgroup.description = comGroupData.description;
        }

        o.comgroup.url = $("#inputGroupUrl").attr('value');
        if(o.comgroup.url == ""){
            o.comgroup.url = comGroupData.url;
        }

        var privacy = $("#publicGroupBtn").hasClass('active') ? 'PUBLIC' : 'PRIVATE'

        if ((privacy == 'PRIVATE') && (vis == 'VISIBLE')){
            o.comgroup.privacy = 'PRIVATE_VISIBLE';

        }else if ((privacy == 'PRIVATE') && (vis == 'INVISIBLE')){
            o.comgroup.privacy = 'PRIVATE_INVISIBLE';
        }else{
            o.comgroup.privacy = 'PUBLIC';
        }

        o.comgroup.territory = $("#inputGroupTerritory").attr('value');

        if(o.comgroup.territory == ""){
            o.comgroup.territory = comGroupData.territory;

        }
        // alert(" Object : " + JSON.stringify(o));
        joynMeApiCall("PUT", 'comgroup/id/' + comGroupId, JSON.stringify(o), function(){
            var stageWidth = $("#stage").width();

            $('#editComGroupBtnTipContainer').hide();
            $('#groupOptionsBtnTipContainer').hide();

            showMessageToUser("Your group has been updated!","alert-success");

            $("#editComGroupScreen").animate({
                left:stageWidth
            }, function () {
                $('.TipShadowBox').fadeOut();
                $('#getGroups').trigger('click');

                $('#' + comGroupId).trigger('click');
            })
        })

    });

// build and add settings page to widget on click of class="settingsIcon"

    $(" body ").on('click','#getSettings', function () {
        var $closestLayerSlider = $(this).closest($('[id$="LayerSlider"]'));
        var detailScreenMargin = parseInt($closestLayerSlider.css("margin-left"));
        var screenWidth = $(".screen").width();
        var stageHeight = $("#stage").height();
        var stageWidth = $("#stage").width();
        var windowWidth = $(window).width();

        $("#settingsScreenLayer").remove();
        var settingsHtml = "<div class='row-fluid'>" +
                "<div class='row-fluid textCenter'>Q:How stoked are you on JoynMe?</div>"+
                "<form>"+
                '<input type="radio" name="sex" value="Unlimited">Unlimited<br>'+
                '<input type="radio" name="sex" value="Suprelemy">Super'+
                '</form>';
        var settingsContainer = "<div class='screenTopBar' style='position: relative;text-align: center'> " +
                "<span class='h1'>Settings</span><div class='backBtn'><span id='cancelSettingsBtn' class='btn-joynme btn span11' style='float: right; margin-top: 1px'> Cancel</span></div><div class='nextBtn'><span id='saveSettingsBtn' class='btn-joynme btn span11' style='float: right; margin-top: 1px'> Save</span>" +
                "</div></div><div id='eventEditContent'> " + settingsHtml + "</div>";
        var settingsScreen = '<div id="settingsScreen" style="background-color:#ccebdc;left:' + stageWidth + 'px;z-index: 999;position: absolute;top: 0px;height: ' + stageHeight + 'px ;width: ' + screenWidth + 'px " >' +
                settingsContainer + '</div>';
        var shadowBoxHtml = '<div class="TipShadowBox" style="position: absolute; top:0px; height: ' + stageHeight + 'px ;width: ' + windowWidth + 'px " ></div>';
        var settingsScreenLayer = "<div id='settingsScreenLayer'> " + shadowBoxHtml + settingsScreen + "</div>";
        $("#stage").append(settingsScreenLayer);
        $("#settingsScreen").animate({
            left:0
        }, function () {
            //alert(" done animation");

        });


        $("#sideMenu").on('click', function () {
            $("#settingsScreenLayer").hide();
            $('.TipShadowBox').fadeOut();
        });


    });



    $("#cancelSettingsBtn").live('click', function () {
        $("#settingsScreenLayer").hide();
        $('.TipShadowBox').fadeOut();
    });

    $("#saveSettingsBtn").live('click', function () {
        $("#settingsScreenLayer").hide();
        $('.TipShadowBox').fadeOut();
    });


	// This function checks to see if a user has logged in with a guest token. Returns true if they have a RO token, returns false if they are a registered user.

    function isGuest(){

       if ($('body').data('loggedInUser') == null){
           return true;
       }else{
           return false;

       }
    }


    var trick = false;
    var comeFrom = "";



    //these are the actions that will cause a check to see if the user has a RO token.  If they are a read only visitor,
    //they will be blocked by the following acitons, and prompted with a login screen



    $('body').on('click','#actionBtns',function(){
           trick = true;
           comeFrom = "actionBtns";
        if (isGuest()){

            showSignUpScreen();
        }

    });

    $('body').on('click','.activityListItemRow',function(){
         trick = true;
         comeFrom = "activityListItemRow";

        if (isGuest()){
            showSignUpScreen();
        }

    });
    $('body').on('click','.mapEvent',function(){
        trick = true;
        comeFrom = "activityListItemRow";

        if (isGuest()){
            showSignUpScreen();
        }

    });


    $('body').on('click','#getNotification',function(){
       trick = true;
       comeFrom = "getNotification";

        if (isGuest()){
            showSignUpScreen();
        }

    });

    $('body').on('click','#getAgenda',function(){
        trick = true;
        comeFrom = "getAgenda";

        if (isGuest()){
            showSignUpScreen();
        }

    });

    $('body').on('click','#getFavorites',function(){
        trick = true;
        comeFrom = "getFavorites";

        if (isGuest()){
            showSignUpScreen();
        }

    });
    $('body').on('click','#planBtn',function(){
        trick = true;
        comeFrom = "planBtn";

        if (isGuest()){
            showSignUpScreen();
        }

    });
    $('body').on('click','#createGroupShowLayer',function(){
        trick = true;
        comeFrom = "createGroupShowLayer";

        if (isGuest()){
            showSignUpScreen();
        }

    });

    $('body').on('click','#text_submit',function(){
        trick = true;
        comeFrom = "text_submit";

        if (isGuest()){
            showSignUpScreen();
        }

    });
    $('body').on('mouseover','#comGroupExtraContainer',function(){
        trick = true;
        comeFrom = "groupDetailsScreen";

        if (isGuest()){
            showSignUpScreen();
        }

    });
    $('body').on('click','#comgroupSubscribeBtn',function(){
        trick = true;
        comeFrom = "groupDetailsScreen";

        if (isGuest()){
            showSignUpScreen();
        }

    });

    //clicking on login will trigger this action
    $('body').on('click','#loginTrigger',function(){
        trick = false;
        comeFrom = "loginTrigger";
        if (isGuest()){

            showSignUpScreen();
        }
    });




    // create SIGN UP SCREEN
    function showSignUpScreen() {


              var widgetWidth = $("#widget").width();
              var widgetHeight = $("#widget").height();
              var screenWidth = $('.screen').width();

              if ($("#signUpLayer").length) {
                  $("#signUpLayer").hide();
              }

                if( $.browser.msie ){
                    var emailPlaceholder = "E-mail:";
                    var passwordPlaceholder = '&nbsp&nbsp' + "Pass:";
                }else{
                    var emailPlaceholder = "";
                    var passwordPlaceholder = "";
                }


              if (comeFrom == "actionBtns" ){
                var wording = "In order to RSVP, we need to know more about you.";

              }else if (comeFrom == "getNotification"){
                var wording = "In order to see notifications, please log in.";
              }else if (comeFrom == "getFavorites"){
                  var wording = "In order to see favorites, please log in.";
              }else if (comeFrom == "getAgenda"){
                  var wording = "In order to see your agenda, please log in.";
              }else if (comeFrom == "planBtn"){
                  var wording = "In order to plan an activity, please log in.";
              }else if (comeFrom == "createGroupShowLayer"){
                  var wording = "In order to create a group, please log in.";
              }else if (comeFrom == "activityListItemRow"){
                  var wording = "In order to view this activity, please log in.";
              }else if (comeFrom == "text_submit"){
                  var wording = "In order to chat with this activity, please log in.";
              }else if (comeFrom == "groupDetailsScreen"){
                  var wording = "Like this group? Please log in to continue.";
              }else if (comeFrom == "loginTrigger"){
                  var wording = "Log In";
              }else{
                  var wording = "Log In";
              }

              var twitterButtonHtml = '';

              // only show twitter button if we are not on the Joynme Facebook Widget
              if( ! isJoynmeFacebookWidget() )
                twitterButtonHtml = '<div class="row-fluid padding10px textCenter"><button id="signInTwitter" class="zocial twitter">&nbspSign in with Twitter&nbsp</button> </div> ';


              var signUpHtml = '<div id="signUpContainer"><div id="signUpWrapper" style="width: ' + screenWidth + 'px' + '" ><span style="margin-right:3px;float:right" id="hideSignUp" >X</span><div style="margin-top:15px; background-color:#55b38C;" class="modal-header"> ' +
                      '<span><img src="images/powered_by_joynme_115.png"/><span class="floatRight createText"><strong>JoynMe Sign In</strong></span></span></div> <div class="modal-body"> <div id="joynMeLogInError"></div> ' + '<div class= "row-fluid textCenter" > ' +
                      '<div style="margin-bottom:10px;font-size: 17pt;">Thanks for being active!</div><div style="font-size:12pt; margin-bottom:10px;">' + wording + '</div><button id="logInBtn" class="zocial facebook " onclick="doLogIn();return false;" autologoutlink="true" ' +
                      'scope="friends_birthday,friends_activities,friends_about_me,email,user_checkins,user_about_me,friends_about_me,user_activities,user_photos,user_videos,publish_stream,offline_access,' +
                      'friends_checkins,publish_checkins"> Sign in with Facebook </button> </div> ' +
                      twitterButtonHtml +
                      '<div class="row-fluid textCenter"> <button id="createJoynMeAccount" class="zocial joynmeSignInBtn"><i class="icon-home icon-white"> </i>| Sign up with E-mail </button>' +
                      '<div class="textCenter" style= padding-top:10px;"><hr class="logInLine"><strong>Already have an account?</strong><span id="signInWithJoynMe" class="logInText"><strong>&nbspSIGN IN</strong></span></div>' +

                      ' <div class="row-fluid signInForm" style="display: none"> <form class="form-horizontal"> <div class="control-group"> <label class="control-label"></label>' +
                      ' <div class="controls">' +emailPlaceholder+ '<input type="text" id="inputEmail" placeholder="E-mail"></div> </div> <div class="control-group">' +
                      ' <label class="control-label"></label><div class="controls">' +
                      ''+passwordPlaceholder+ '<input type="password" id="inputPassword" placeholder="Password"> </div> </div>' +
                      ' <div class="control-group"> <div class="controls" style="float: left;margin-left: 125px;">' +
                      ' <span id="forgotPassword" class="logInText"><strong>&nbspForgot Password?</strong></span> <button id="logIn" type="button" class="center btn-success btn">Sign in</button> </div> </div> </form>' +
                      ' </div> </div></div> ';

              var shadowBoxHtml = '<div class="SignUpShadowBox" style="position: absolute; top:0px; height: ' + widgetHeight + 'px ;width: ' + widgetWidth + 'px " ></div>';
              var signUpLayer = "<div id='signUpLayer'>" + shadowBoxHtml + signUpHtml + "</div>";
              $("#widget").append(signUpLayer);


    }

    //add a listener for the x button on the login screen, then depending on where you come from, show a different screen upon closing it

    $('body').on('click',"#hideSignUp",function(){

        $("#signUpLayer").hide();

        if ((comeFrom == "activityListItemRow") || (comeFrom == "getNotification") || (comeFrom == "getFavorites")||  (comeFrom = "loginTrigger") || (comeFrom == "getAgenda")){

            $('.getEvents').trigger('click');

        }else if( comeFrom = "createGroupShowLayer"){

            $('#getGroups').trigger('click');

        }

    });



    // create account  btn listen
    $("#createJoynMeAccount").live('click', function () {
        $("#signUpContainer").hide();

        var widgetWidth = $("#widget").width();
        var widgetHeight = $("#widget").height();
        var screenWidth = $('.screen').width();

        if ($("#createLayer").length) {
            $("#createLayer").hide();
        }

        var signUpHtml = '<div id="createContainer" ><div id="createWrapper" style=" width: ' + screenWidth + 'px' + '" ><div style="background-color:#55b38C;" class="modal-header"> ' +
                '<span><img src="images/powered_by_joynme_115.png"/><span class="floatRight createText"><strong>Create Account</strong></span> </div> <div class="modal-body">' +
                '<div class="comGroupContainer" id="comGroupDetail"> <div class="row-fluid "> ' +
                '<div class="span2"><span id="imageHolder"></span><form id="comgroupImgForm" >' +
                '<div id="fileHolder"><input class="placeImage" type="file" name="files[0]" id="comGroupImgFile" onchange="readURL(this)"></div></form></div>' +
                ' <div class="span10" style="border-left: solid 1px #868686"> <div style="border-bottom: solid 1px #868686"><input class="span12" style="margin: 0px; border: none" type="text" id="inputFirstName" placeholder="First Name"></div>' +
                '<input class="span12" style="margin: 0px; border: none" type="text" id="inputLastName" placeholder="Last Name"></div> </div> <hr class="dHr"> <div class="row-fluid"> ' +
                '<div style="border-bottom: solid 1px #868686"><input style="margin: 0px; border: none" class="span12" type="text" id="inputEmailAddress" placeholder="Email Address"></div>' +
                '<div><input style="margin: 0px; border: none" class="span12" type="password" id="createPassword" placeholder="Password"></div>' +
                '</div>' +
                '</div>' +
                '<div class="padding10px center"><button id="cancelCreateAccountBtn"  type="button" class="btn">Go Back</button><span>&nbsp&nbsp&nbsp</span><button id="createAccountBtn" type="button" class="btn-success btn">Create Account</button></div><hr class="logInLine">'+
                '<div class="textCenter" style= padding-top:10px;"><strong>Already have an account?</strong><span id="signInWithJoynMe" class="logInText"><strong>&nbspSIGN IN</strong></span></div></div>';




        var shadowBoxHtml = '<div class="SignUpShadowBox" style="position: absolute; top:0px; height: ' + widgetHeight + 'px ;width: ' + widgetWidth + 'px " ></div>';
        var createJoynMeAccountLayer = "<div id='createLayer'>" + signUpHtml + "</div>";
        $("#widget").append(createJoynMeAccountLayer);


    });




    $('body').on('click', '#cancelCreateAccountBtn', function(){
        $("#createContainer").remove();
      //  $("#SignUpShadowBox").hide();
        $("#signUpContainer").show();
    });

    $('body').on('click', '#forgotPassword', function(){
       alert('FIXME: We will remember your password soon!');
    });



    //  Search for activities
    $("#searchActivitiesScreen").keyup(function () {
        //alert($(this).val());
        var q = $(this).val();
        searchActivities(eventsListData, q, "#eventsListContainer", 'event');

    });
    $("#searchGroupActivitiesScreen").keyup(function () {
        //alert($(this).val());
        var q = $(this).val();
        searchActivities(eventsListData, q, "#groupActivitiesListContainer", 'comGroupEvent');

    });

    function searchActivities(data, q, selectorToFill, specifiClass){
        var searchResult = searchJsonObject(data, 'activityName', q);
        if (q == '') {
            //alert("it is empty");
            printEvents(activitiesListObject, selectorToFill, specifiClass, 'time');
        }
        else {
            if (searchResult.length != 0) {
                //alert(" there is match");
                // LOG(searchResult);
                printEvents(searchResult, selectorToFill, specifiClass, 'time');
            }
            else {
                $(selectorToFill).html(" <hr class='hr'> <h1>No match at this moment.</h1>");
            }
        }
    }

    // clear the invitees when chnaging to a different screen


    // hide side Menu if it is shown
    function hideSideMenu() {
         clearInvitees();
         console.log("fb -> " + fbFriendInvited);
         console.log(" group _> " + groupFriendInvited);
         if ($("#sideMenu").width != 0 && eventWindowManager.viewType == "oneScreen") {
            $("#sideMenu").animate({
                width:0
            });
         }
    }



    // search facebook friends

    $("#searchInviteFriends, #searchInviteFriendsScreen2 ").live('keyup', function (e) {
        var target = e.target.id;
        var q = $(this).val();
        var searchResult = searchFbFriends(fbFriendsObject, 'name', q);
        var containerToFill = target === 'searchInviteFriendsScreen2' ? '#friendsToInviteScreenStep2' : '#friendToInviteContainer';
        var screenType = target === 'searchInviteFriendsScreen2' ? 'screenStep2' : 'InviteScreenFromDetail';
        if (q == '') {
            //alert("it is empty");
            $(containerToFill).html(printFBFriends(fbFriendsObject, screenType,'f'));
        }
        else {
            if (searchResult.length != 0) {
                //alert(" there is match");
                // LOG(searchResult);
                $(containerToFill).html(printFBFriends(searchResult, screenType,'f'));

            }
            else {
                $(containerToFill).html(" No match.");
            }
        }
    });
     // search through activities type

    $("#searchFavorites").live('keyup', function (e) {
        var q = $(this).val();
        var $containerToFill =  $("#favoritesContainer");
        var searchResult = searchFavoriteTypes( activitiesType, 'name', q);

        if (q == '') {
            //alert("it is empty");
           // $containerToFill.html(printFBFriends(activitiesType, screenType));
            printActivitiesType(activitiesType);
        }
        else {
            if (searchResult.length != 0) {
                //alert(" there is match");
                // LOG(searchResult);
                printActivitiesType(searchResult);
               // $containerToFill.html(printFBFriends(searchResult, screenType));

            }
            else {
                $containerToFill.html(" No match.");
            }
        }
    });






    // when selecting a friend to invite
    $(" body ").on('click', ' .fbFriendItem ',  function () {
        var dataScreen = $(this).attr('data-screen');
        var FBfriendSelected = {};
        var dataItemId = $(this).attr('data-itemId');
        var dataName = $(this).attr('data-name');
        var $pill = $("#" + dataItemId+ "PilItem");
                 if (!$pill.length){
                     $("#" + dataScreen + " .friendsInvitedBar").append("<div id='" + dataItemId + "PilItem" + "' class='pilContainer'><a class='closeFBPil'></a> " + dataName + "</div>");
                     FBfriendSelected.name = dataName;
                     FBfriendSelected.id = dataItemId;
                     fbFriendInvited.push(FBfriendSelected);
                     console.log(" fb invited: " + fbFriendInvited);
                 }
                 else{
                    alert(" event - fb friend =>  already in the invitee list");
                 }
    });
    $(" body ").on('click', ' .yahooFriendItem ',  function () {
        //alert($(this).closest($('[id$="Layer"]')).attr('id'));
        console.log($(this).closest($('[id$="Layer"]')).attr('id'));
        var dataScreen = $(this).closest($('[id$="Layer"]')).attr('id');
        var YahooFriendSelected = {};
        var dataItemId = $(this).attr('data-itemId');
        var dataName = $(this).attr('data-name');
        var dataEmail = $(this).attr('data-e');
        var $pill = $("#" + dataItemId+ "YPilItem");
                 if (!$pill.length){
                     $("#" + dataScreen + " .friendsInvitedBar").append("<div id='" + dataItemId + "YPilItem" + "' class='pilContainerYahoo'><a class='closeYPil'></a> " + dataName + "</div>");
                     YahooFriendSelected.name = dataName;
                     YahooFriendSelected.id = dataItemId;
                     YahooFriendSelected.email = dataEmail;
                     yahooContactsInvited.push(YahooFriendSelected);
                     console.log(" Yahoo friends selected: " + yahooContactsInvited);
                 }
                 else{
                    alert(" event - Yahoo friend =>  already in the invitee list");
                 }
    });
    // remove a pil container (yahoo contacts)
    $(" body ").on('click', '.closeYPil', function () {
        var $thisParent = $(this).parent();
        //alert($thisParent.parent().attr('id'));
        var inviteScreenContainer = $thisParent.parent().attr('id');
        var friendId;
        friendId = $thisParent.attr('id').replace('YPilItem', '');
        //alert(friendId);
        removeJsonObject(yahooContactsInvited, 'id', friendId);
        LOG(" Yahoo friends invited: ");
        LOG(yahooContactsInvited);
        $thisParent.remove();


    });
    // when selecting a friend (twitter follower) to invite
    $(" body ").on('click', ' .TFollowerItem ',  function () {
        var dataScreen = $(this).attr('data-screen');
        var TFollowerSelected = {};
        var dataItemId = $(this).attr('data-itemId');
        var dataName = $(this).attr('data-name');
        var $pill = $("#" + dataItemId+ "TPilItem");
                 if (!$pill.length){
                     $("#" + dataScreen + " .friendsInvitedBar").append("<div id='" + dataItemId + "TPilItem" + "' class='pilContainer'><a class='closeTPil'></a> " + dataName + "</div>");
                     TFollowerSelected.name = dataName;
                     TFollowerSelected.id = dataItemId;
                     TFollowersInvited.push(TFollowerSelected);
                     console.log(" Twitter followers  invited: " + TFollowersInvited);
                 }
                 else{
                    alert(" event - Twitter follower =>  already in the invitee list");
                 }
    });

    // when selecting a contact friend (gmail) to invite
    $(" body ").on('click', ' .gmailContactToInvite ',  function () {
        var dataScreen = $(this).attr('data-screen');
        var dataEmail = $(this).attr('data-e');
        var contactName = $(this).attr('data-cn');
        var GmailContactSelected = {};
        var i = dataEmail.substring(0, dataEmail.indexOf('@')).replace('.','');

        //alert(i);
        var $pill = $("#" + i + "GPilItem");
                 if (!$pill.length){
                     $("#" + dataScreen + " .friendsInvitedBar").append("<div id='" + i + "GPilItem" + "' class='pilContainerGmail'><a class='closeGmailPil'></a> " + contactName+ "</div>");
                     GmailContactSelected.name = contactName;
                     GmailContactSelected.email = dataEmail;
                     GmailContactSelected.i = i;
                     gmailContactsInvited.push(GmailContactSelected);
                     console.log(" gmail contact  invited: " + GmailContactSelected);
                 }
                 else{
                    alert(" event - Gmail Contact =>  already in the invitee list");
                 }
    });

    // remove a pil container (invite gmail contact )
    $(" body ").on('click', '.closeGmailPil', function () {
        var $thisParent = $(this).parent();
       var closeParentId =  $thisParent.attr('id');
        var gmailE = closeParentId.replace('GPilItem', '');
        //alert(JSON.stringify(gmailContactsInvited));
        removeJsonObject(gmailContactsInvited, 'i', gmailE);      // i internal id
        ///alert(JSON.stringify(gmailContactsInvited));
        LOG(" gmail invited: " + gmailContactsInvited);
        $thisParent.remove();


    });


    //  when selecting a agroup to invite from the invite screen
    $(' body ').on(' click ', ' .groupToInviteItem ', function(){
        var dataScreen = $(this).attr('data-screen');
        var groupSelected = {};
        var dataItemId = $(this).attr('data-itemId');
        var dataName = $(this).attr('data-name');
        var screenType = $(this).attr('data-screen');
        var $pill = $("#" + dataItemId+ "GroupPilItem");
            if (!$pill.length) {
                $("#" + dataScreen + " .friendsInvitedBar").append("<div id='" + dataItemId + "GroupPilItem" + "' class='pilContainerGroup'><a class='closeGroupPil'></a> " + dataName + "</div>");
                groupSelected.name = dataName;
                groupSelected.id = dataItemId;
                groupFriendInvited.push(groupSelected);
                console.log(groupFriendInvited);
                //alert(" from details screen " + JSON.stringify(groupToInviteSelectedScreen2));
            }
            else {
                alert(" group - Already in the invitee list");
            }


    });


    // remove a pil container (invite fb friend screen)
    $(" body ").on('click', '.closeFBPil', function () {
        var $thisParent = $(this).parent();
        //alert($thisParent.parent().attr('id'));
        var inviteScreenContainer = $thisParent.parent().attr('id');
        var friendId;
            friendId = $thisParent.attr('id').replace('PilItem', '');
            removeJsonObject(fbFriendInvited, 'id', friendId);
            LOG(" fb invited: " + fbFriendInvited);
            $thisParent.remove();


    });

    // remove a pil container (invite twitter friend screen)

    $(" body ").on('click', '.closeTPil', function () {
        var $thisParent = $(this).parent();
        //alert($thisParent.parent().attr('id'));
        var inviteScreenContainer = $thisParent.parent().attr('id');
        var friendId;
            friendId = $thisParent.attr('id').replace('TPilItem', '');
            removeJsonObject(TFollowersInvited, 'id', friendId);
            LOG(" Twitter follower invited: " + TFollowersInvited);
            $thisParent.remove();


    });


    // remove a pil container (invite fb friend screen)
    $(' body ').on('click', " .closeGroupPil ", function () {
        var $thisParent = $(this).parent();
        //alert($thisParent.parent().attr('id'));
        var inviteScreenContainer = $thisParent.parent().attr('id');
        var friendId;

            friendId = $thisParent.attr('id').replace('GroupPilItem', '');
            removeJsonObject(groupFriendInvited, 'id', friendId);
            LOG(" Group invited: " + groupFriendInvited);
            $thisParent.remove();


    });


    // mouse over #firendsInvited to see all the invited friends

    $('#firendsInvited').live('mouseover mouseout', function (event) {
        if (event.type == 'mouseover') {

        } else {

        }
    });

    /*// process facebook invitation
    function sendInvites(fbFriendsInvited, eventId) {
        var  postedEventId = eventId;
        alert(" facebook friedns selected: " + JSON.stringify(fbFriendSelected));
        //alert(" groups selected: " + JSON.stringify(groupSelectedToInvite));
        $.each(fbFriendsInvited, function (k) {
            var fbId = {};
            fbId.id = fbFriendsInvited[k].id;
            processObject(fbId, eventInviteObject.facebookFriendList)
            //eventInviteObject.facebookFriendList.push(fbId);
            //console.log("Facebook friends: " + fbFriendSelected[k].id);
        });
        eventInviteObject.sendFacebook = true;
        eventInviteObject.postMeFacebook = true;
        eventInviteObject.token = token;
        //alert("Facebook friends invited: " + JSON.stringify(eventInviteObject));
        //alert(JSON.stringify(planedEvent));
        //alert(JSON.stringify(eventInviteObject));
        //doApiCall2('POST', 'event', JSON.stringify(planedEvent));
        // alert("event Id: " + planedEvent.event.activityId);
        joynMeApiCall('PUT', 'event/id/' + postedEventId + '/invite', JSON.stringify(eventInviteObject));
    }*/

     // getListFavorites button

    var  userFavoriteActivites;               //GET list event which are user favorite activites
    $(' body ').on(' click ', '#getListFavorites', function(){
        var tokenO = {
                "token":queryString.token,
                "latitude":37.579413,
                "longitude":-121.728516,
                "lonMin":-121.766281,  "lonMax":-121.692982,
                "latMin":37.552607,    "latMax":37.60682,
                "limit":100
                }
        joynMeApiCall( 'GET', 'event/favorite/', JSON.stringify(tokenO), function(localReturnedObject){
            //console.log(JSON.stringify(apiReturnedObject));
            userFavoriteActivites = localReturnedObject.eventList;
           // alert(activitiesListObject);
            printEvents(userFavoriteActivites, "#eventsListContainer", 'event', 'time');

        })

    });
    $(' body ').on(' click ', '#getAllEvents', function(){
        var sortBy = $('#getListByTime').hasClass('active') ? 'time' : 'distance';
        printEvents(activitiesListObject, "#eventsListContainer", 'event', sortBy);
    });
    // on click -> invite button from details screen
    $(' body ').on('click', '#inviteBtnScreenDetail', function () {
        var screenWidth = $(".screen").width();
        // alert(screenWidth);
        ///alert('process invites');
        //var eventId = $("#inviteFriendsBtn").attr('data-event');
        var objectId = $(this).attr('data-event');
        var dataType = $(this).attr('data-type');
        var inviteType = dataType == 'event' ? 'event' : 'group'
        //alert(objectId);
        //alert(inviteType);
        if (fbFriendInvited.length || TFollowersInvited.length || groupFriendInvited.length || gmailContactsInvited.length || yahooContactsInvited.length || emailContactsInvited.length) {
            sendInvites(inviteType,objectId, fbFriendInvited,TFollowersInvited, groupFriendInvited,gmailContactsInvited,yahooContactsInvited,emailContactsInvited);
            showMessageToUser('Invitation sent successfully', 'alert-success');
            $('.inviteScreen').animate({
                'right':-screenWidth + "px"
            });

        }
        else {
            alert(" Please choose friends to invite");
        }
    });

    // pending request button

    $(' body ').on(' click ', '#pendingRequestBtn', function(){

        var adminActionPendingUsers = $('body').data('adminRequests');

        var $this = $(this);

        var screenWidth = $(".screen").width();
        var stageHeight = $("#stage").height();
        var windowWidth = $(window).width();
        var pendingMemberPictureUrl = "";
        var membersToApprove = false;
        var pendingApproval = "";
        var pendingRequestContainer = "<div class='screenTopBar' style='position: relative;text-align: center'> " +
                '<div class="backBtn"><button id="closePendingRequestScreen" class="backToCurrentGroup joynmeBtn"></button></div><span class="h1"> Pending Requests</span></div>' +
                "<div class='pendingRequestContainer'>";




        var pendingApproval = "<div class='span12 dateSeparator screenTopBar' style='padding-bottom:2px;margin-left:0px'>Pending Approval</div>";

        //loop through the list adding those who have reqested to join

        $.each(adminActionPendingUsers.comgroupSocialInviteMapList, function(k){

            var pendingMemberInvitationId = adminActionPendingUsers.comgroupSocialInviteMapList[k].id;

           if ((adminActionPendingUsers.comgroupSocialInviteMapList[k].userApproved) && (!adminActionPendingUsers.comgroupSocialInviteMapList[k].adminDenied)){
            var pendingMemberName = adminActionPendingUsers.comgroupSocialInviteMapList[k].friend.first+ ' ' + adminActionPendingUsers.comgroupSocialInviteMapList[k].friend.last;

            if (adminActionPendingUsers.comgroupSocialInviteMapList[k].mapType == "joynme"){
                  pendingMemberPictureUrl =  "http://demo.joynmenow.com:8080/dailybread/user/id/"+ adminActionPendingUsers.comgroupSocialInviteMapList[k].friend.id + "/picture/0";

            }else if (adminActionPendingUsers.comgroupSocialInviteMapList[k].mapType == "facebook"){

                 pendingMemberPictureUrl =  "https://graph.facebook.com/"+ adminActionPendingUsers.comgroupSocialInviteMapList[k].friend.id + "/picture";

            }else if (adminActionPendingUsers.comgroupSocialInviteMapList[k].mapType == "twitter"){

                pendingMemberPictureUrl = "http://api.twitter.com/1/users/profile_image/" + twitterUserName + ".format";
            }


               pendingApproval += "<div style='background-color: #FFFFFF;' class='row-fluid'>" +
                                "<div class='span2'>" +
                                    "<img style='max-width:80%' src ='"+pendingMemberPictureUrl+"'>" +
                                "</div>" +
                                "<div class ='span10'>" +
                                    "<span style='display:inline-block; margin-top:12px'>"+
                                        "<a class='pendingUser eventTitle' id='"+pendingMemberInvitationId+"' >" + pendingMemberName+ "</a>" +
                                    "</span>" +
                                "</div></div><hr style='margin:0px;'>";

           }

        });





        //loop through the list adding those who have been invited but not yet approved

          pendingApproval += "<div class='span12 dateSeparator screenTopBar' style='padding-bottom:2px;margin-left:0px'>Invited</div>";

        $.each(adminActionPendingUsers.comgroupSocialInviteMapList, function(v){

            if (!adminActionPendingUsers.comgroupSocialInviteMapList[v].userApproved) {
                var pendingMemberName = adminActionPendingUsers.comgroupSocialInviteMapList[v].friend.first+ ' ' + adminActionPendingUsers.comgroupSocialInviteMapList[v].friend.last;

                if (adminActionPendingUsers.comgroupSocialInviteMapList[v].mapType == "joynme"){
                    pendingMemberPictureUrl =  "http://demo.joynmenow.com:8080/dailybread/user/id/"+ adminActionPendingUsers.comgroupSocialInviteMapList[v].friend.id + "/picture/0";


                }else if (adminActionPendingUsers.comgroupSocialInviteMapList[v].mapType == "facebook"){

                    pendingMemberPictureUrl =  "https://graph.facebook.com/"+ adminActionPendingUsers.comgroupSocialInviteMapList[v].friend.id + "/picture";

                }else if (adminActionPendingUsers.comgroupSocialInviteMapList[v].mapType == "twitter"){

                    pendingMemberPictureUrl =  "http://api.twitter.com/1/users/profile_image/" + twitterUserName + ".format";
                }


                pendingApproval += "<div style='background-color: #FFFFFF;' class='row-fluid'>" +
                        "<div class='span2'>" +
                        "<img style='max-width:80%' onerror='imgError(this)' src ='"+pendingMemberPictureUrl+"'>" +
                        "</div>" +
                        "<div class ='span10'>" +
                        "<span class ='eventTitle' style='display:inline-block; margin-top:12px'>" + pendingMemberName+" </span>" +
                        "</div></div><hr style='margin:0px;'>";

            }

        });



        //loop through the list adding those who have been declined by an admin to the declined approval list

        pendingApproval += "<div class='span12 dateSeparator screenTopBar' style='padding-bottom:2px;margin-left:0px'>Declined Approval</div>";

        $.each(adminActionPendingUsers.comgroupSocialInviteMapList, function(a){

            var pendingMemberInvitationId = adminActionPendingUsers.comgroupSocialInviteMapList[a].id;

            if (adminActionPendingUsers.comgroupSocialInviteMapList[a].adminDenied) {
                var pendingMemberName = adminActionPendingUsers.comgroupSocialInviteMapList[a].friend.first+ ' ' + adminActionPendingUsers.comgroupSocialInviteMapList[a].friend.last;

                if (adminActionPendingUsers.comgroupSocialInviteMapList[a].mapType == "joynme"){
                    pendingMemberPictureUrl =  "http://demo.joynmenow.com:8080/dailybread/user/id/"+ adminActionPendingUsers.comgroupSocialInviteMapList[a].friend.id + "/picture/0";


                }else if (adminActionPendingUsers.comgroupSocialInviteMapList[a].mapType == "facebook"){

                    pendingMemberPictureUrl =  "https://graph.facebook.com/"+ adminActionPendingUsers.comgroupSocialInviteMapList[a].friend.id + "/picture";
                }else if (adminActionPendingUsers.comgroupSocialInviteMapList[a].mapType == "twitter"){

                    pendingMemberPictureUrl =  "http://api.twitter.com/1/users/profile_image/" + twitterUserName + ".format";
                }




                pendingApproval += "<div style='background-color: #FFFFFF;' class='row-fluid'>" +
                        "<div class='span2'>" +
                        "<img style='max-width:80%' src ='"+pendingMemberPictureUrl+"'>" +
                        "</div>" +
                        "<div class ='span10'>" +
                        "<span style='display:inline-block; margin-top:12px'>"+
                        "<a class='pendingUser eventTitle' id='"+pendingMemberInvitationId+"' >" + pendingMemberName+ "</a>" +
                        "</span>" +
                        "</div></div><hr style='margin:0px;'>";


            }

        });


//done adding people to the list

        $("#pendingRequestLayer").remove();
        var pendingRequestScreen = '<div class="pendingRequestScreen inviteScreen" style="right: -' + screenWidth + 'px;z-index: 9999;position: absolute;top: 0px;height: ' + stageHeight + 'px ;width: ' + screenWidth + 'px " ></div>';
        var shadowBoxHtml = '<div class="TipShadowBox" style="position: absolute; top0px; height: ' + stageHeight + 'px ;width: ' + windowWidth + 'px " ></div>';
        var pendingRequestLayer = "<div id='pendingRequestLayer'> " + shadowBoxHtml + pendingRequestScreen + "</div>";
        $("#stage").append(pendingRequestLayer);
        //$("#stage").append(inviteScreen);
        //alert(createActivityStepTwo.screenHtml());
        var endDiv = "</div>";
        $(".pendingRequestScreen").html(pendingRequestContainer+ pendingApproval + endDiv);



        $('.screen').css('width', screenWidth);
        $(".pendingRequestScreen").animate({
            right:0
        }, function () {
            //alert(printFBFriends(fbFriendsObject));
            /*var fbfHtml = printFBFriends(fbFriendsObject, 'inviteScreenLayer');
            if (fbfHtml) {
                $("#inviteScreenLayer .friendToInviteContainer").html(printFBFriends(fbFriendsObject, 'inviteScreenLayer'));
            }
            else {
                $("#inviteScreenLayer .friendToInviteContainer").html(" Please sign in to facebook ");

            }*/
            //inputFocus();
        });
    });

    $('#closePendingRequestScreen').live('click',function(){
        $("#pendingRequestLayer").hide();
    });




    $('body').on('click',".pendingUser",function(){
        var pendingMemberInvitationId = this.id;

        var signUpHtml = '<div style="z-index:9999;"   id="signUpContainer">' +
                            '<div id="signUpWrapper" style=" width: ' + screenWidth + 'px' + '" >' +
                                '<div class="modal-header textCenter"> ' +
                                    '<h5>Would you like to approve this member?</h5>' +
                                '</div>' +
                                '<div class="modal-body">' +
                                    '<div class="row-fluid textCenter">' +
                                        '<button class="myBtn btn btn-success" id="approveBtn" data-event="'+pendingMemberInvitationId+'" >Approve Request</button>' +
                                    '</div>' +
                                    '<hr class="hr" > ' +
                                    '<div class="row-fluid textCenter">' +
                                        '<button style="background-color:red" class="btn btn-success-red" id="declineBtn" data-event="'+pendingMemberInvitationId+'" >Decline Request</button>' +
                                    '</div> ' +
                                    '<hr class="hr" > ' +
                                    '<div  class="row-fluid">' +
                                        '<button id="closeDefineFate" >Close</button>' +
                                    '</div> ' +
                                '</div>' +
                            '</div>' +
                         '</div>';


        var signUpLayer = "<div id='defineFate'>" + signUpHtml + "</div>";
        $("#widget").append(signUpLayer);


        $('body').on('click',"#approveBtn",function(){

            var tokenO = {};
            tokenO.token = queryString.token;

            var approvedMemberId =  $("#approveBtn").attr("data-event");

            if (approvedMemberId){


                joynMeApiCall("PUT", "comgroup/id/" +comGroupId+ "/admin/invitations/" +approvedMemberId+ "/approve", JSON.stringify(tokenO), function () {
                    showMessageToUser("Request Approved!", "alert-success");
                });

            }

            $("#signUpContainer").remove();
            $("#pendingRequestLayer").remove();

            $("#" + comGroupId).trigger('click');

           // $("#pendingRequestBtn").trigger('click');


        });


        $('body').on('click',"#declineBtn",function(){
            var tokenO = {};
            tokenO.token = queryString.token;
            var approvedMemberId =  $("#declineBtn").attr("data-event");

            if (approvedMemberId){
                alert(approvedMemberId);

                 joynMeApiCall("DELETE", "comgroup/id/" +comGroupId+ "/admin/invitations/" +approvedMemberId+ "/approve/token/" + tokenO.token , JSON.stringify(tokenO), function () {
                     showMessageToUser("Request Declined!", "alert-error");

                 });
            }

            $("#signUpContainer").remove();
            $("#pendingRequestLayer").remove();

            $("#" + comGroupId).trigger('click');

         //   $("#pendingRequestBtn").trigger('click');


        });


        $('body').on('click',"#closeDefineFate",function(){
            $("#signUpContainer").remove();
        });


    });


    // invite friends button
    $('body ').on('click',' #inviteFriendsBtn ', function () {
        var screenWidth = $(".screen").width();
        var stageHeight = $("#stage").height();
        var windowWidth = $(window).width();
        var inviteType = $("#inviteFriendsBtn").attr('data-type');
        var objectId = $("#inviteFriendsBtn").attr('data-event');
       // alert(inviteType);
        //alert(objectId);
        var friendsOptionHtml = '<div class="row-fluid" style="padding: 0px 4px">' +
                '<button  type="button" class="showFBToInviteBtn btn active btn-medium" style="font-size: 12px"><i class="zocial facebook icon" style="font-size: 8px; vertical-align: -5px"></i>Facebook</button>' +
                '<button  type="button" class="showTFollowersToInviteBtn btn active btn-medium" style="font-size: 12px"><i class="zocial twitter icon" style="font-size: 8px; vertical-align: -5px"></i>Twitter</button>' +
                '<button type="button" class="showGroupToInviteBtn btn active btn-medium" style="font-size: 12px"><i class="zocial icon groupInviteIcon" style="font-size: 8px; vertical-align: -5px"></i>Group</button>' +
                '<button type="button" class="showContactsToInviteBtn btn active btn-medium" style="font-size: 12px"><i class="zocial gmail icon " style="font-size: 8px; vertical-align: -5px"></i>Gmail</button>' +
                '<button type="button"  class="showYahooContactsToInviteBtn btn active btn-medium" style="font-size: 12px"><i class="zocial icon yahoo " style="font-size: 8px; vertical-align: -5px"></i>Yahoo</button>' +
                '<button type="button" class="addEmailtoInviteBtn btn active btn-medium" style="font-size: 12px"><i class="zocial email icon " style="font-size: 8px; vertical-align: -5px"></i>Email</button>' +
                '</div></div>';
        var searchFbFriendsHtml = friendsOptionHtml + " <div class='row-fluid'> <div class='span12' style='padding: 0px 4px'> <input type='text' class='span12' id='searchInviteFriends' placeholder ='Search friends....'></div></div>";
        var friendsToInviteContainer = "<div class='screenTopBar' style='position: relative;text-align: center'> " +
                "<span class='h1'> Invite Friends</span><div class='backBtn'></div><div class='nextBtn'></div>" +
                "</div> " + searchFbFriendsHtml + "<div class='friendsInvitedBar friendsInvitedContainer'><span>Invite: </span></div>"
                + "<div class='friendToInviteContainer'></div>" +
                "<div class='row-fluid'><div class='span4'></div><div class='span4'>" +
                "<div data-event='" + objectId +"' data-type='" + inviteType + "' id='inviteBtnScreenDetail' class='btn btn-success span12' style='margin-top: 10px; font-size: 12pt; text-shadow: 0px 2px green'> Invite</div>" +
                "</div><div class='span4'></div></div>";
        // alert( "Invite Process" );
        $("#inviteScreenLayer").remove();
        var inviteScreen = '<div class="inviteScreen" style="right: -' + screenWidth + 'px;z-index: 9999;position: absolute;top: 0px;height: ' + stageHeight + 'px ;width: ' + screenWidth + 'px " ></div>';
        var shadowBoxHtml = '<div class="TipShadowBox" style="position: absolute; top0px; height: ' + stageHeight + 'px ;width: ' + windowWidth + 'px " ></div>';
        var inviteLayer = "<div id='inviteScreenLayer'> " + shadowBoxHtml + inviteScreen + "</div>";
        $("#stage").append(inviteLayer);
        //$("#stage").append(inviteScreen);
        //alert(createActivityStepTwo.screenHtml());
        $(".inviteScreen").html(friendsToInviteContainer);
        $('.screen').css('width', screenWidth);
        $(".inviteScreen").animate({
            right:0
        }, function () {
            //alert(printFBFriends(fbFriendsObject));
            var fbfHtml = printFBFriends(fbFriendsObject, 'inviteScreenLayer','f');
            if (fbfHtml) {
                $("#inviteScreenLayer .friendToInviteContainer").html(printFBFriends(fbFriendsObject, 'inviteScreenLayer','f'));
            }
            else {
                $("#inviteScreenLayer .friendToInviteContainer").html(" Please sign in to facebook ");

            }
            //inputFocus();
        });
    });

    // on click on group tab on invite screen
    /*$(" body ").on(' click ', ' #showFBToInviteBtn2 ', function(){
        //alert(widget.groupToInvite);
        $(".friendToInviteContainer").html(printFBFriends(fbFriendsObject));

    });
    // on click on group tab on invite screen
    $(" body ").on(' click ', ' #showGroupToInviteBtn ', function(){
        //alert(JSON.stringify(widget.groupToInvite));
        $("friendToInviteContainer").html(returnGroupToInvite(widget.groupToInvite));

    });*/
    $(" body ").on(' click ', ' .showFBToInviteBtn ', function(){

        //alert(widget.groupToInvite);
        var $thisP = $(this).parent();
        var dataScreen = $thisP.parent().attr('data-screen');
       // alert(dataScreen);
        if ( dataScreen == 'undefined'){ dataScreen = 'shadowBox'} // this means that the screen that has facebook tab is the shadow box screen
        var layer = dataScreen == 'eventLayer' ? 'createActivityLayer' :  dataScreen == 'groupLayer' ? 'createGroupLayer' : 'inviteScreenLayer';
         $( "#" + layer + " .friendToInviteContainer").html(printFBFriends(fbFriendsObject, layer, 'f'));
        //alert(layer);

    });
    $(" body ").on(' click ', ' .showTFollowersToInviteBtn ', function(){
        //alert(widget.groupToInvite);
        var $thisP = $(this).parent();
        var dataScreen = $thisP.parent().attr('data-screen');
       // alert(dataScreen);
        if ( dataScreen == 'undefined'){ dataScreen = 'shadowBox'} // this means that the screen that has facebook tab is the shadow box screen
        var layer = dataScreen == 'eventLayer' ? 'createActivityLayer' :  dataScreen == 'groupLayer' ? 'createGroupLayer' : 'inviteScreenLayer';
         $( "#" + layer + " .friendToInviteContainer").html(printFBFriends(TwitterFollowersObject, layer,'t'));
        //alert(layer);

    });
    // on click on group tab on invite screen
    $(" body ").on(' click ', '.showGroupToInviteBtn ', function(){
        //alert(JSON.stringify(widget.groupToInvite));
        var $thisP = $(this).parent();
        var dataScreen = $thisP.parent().attr('data-screen');
        //alert(dataScreen);
        if ( dataScreen == 'undefined'){ dataScreen = 'shadowBox'} // this means that the screen that has facebook tab is the shadow box screen
        var layer = dataScreen == 'eventLayer' ? 'createActivityLayer' :  dataScreen == 'groupLayer' ? 'createGroupLayer' : 'inviteScreenLayer';
        $( "#" + layer + " .friendToInviteContainer").html(returnGroupToInvite(widget.groupToInvite, layer));
    });

    $(" body ").on(' click ', '.showContactsToInviteBtn ', function(){
        //alert(JSON.stringify(widget.groupToInvite));
        //alert(' show email contacts');
        var gmailAuthBtn = '<button class="btn btn-medium"  id="authorize-button"><i class="zocial gmail icon" style="font-size: 8px"></i>Gmail contacts</button>';
        var $thisP = $(this).parent();
        var dataScreen = $thisP.parent().attr('data-screen');
        //alert(dataScreen);
        if ( dataScreen == 'undefined'){ dataScreen = 'shadowBox'} // this means that the screen that has facebook tab is the shadow box screen  //inviteScreenLayer
        var layer = dataScreen == 'eventLayer' ? 'createActivityLayer' :  dataScreen == 'groupLayer' ? 'createGroupLayer' : 'inviteScreenLayer';
        //alert(layer);

        //$( "#" + layer + " .friendToInviteContainer").html($contactsHtml.html() || gmailAuthBtn);
        gmailContacts.length > 0 ? printGmailContacts(gmailContacts, layer) : $( "#" + layer + " .friendToInviteContainer").html(gmailAuthBtn);

    });



    // on click yahoo btn
    $('body').on(' click', ' #yahooAuthBtn ',function(){
         popitup('http://joynme.com/community-example/yahoo/examples/simpleauth/simpleauth.php?openid_mode=discover');
    });



    // show yahoo contacts
    $(" body ").on(' click ', '.showYahooContactsToInviteBtn ', function(){
        console.log(yahooContacts);
       // alert(' show yahoo email contacts');
        var yahooAuthBtn = '<button class="btn btn-medium"  id="yahooAuthBtn"><i class="zocial yahoo icon" style="font-size: 8px"></i>Yahoo contacts</button>';
        var $thisP = $(this).parent();
        var dataScreen = $thisP.parent().attr('data-screen');
        //alert(dataScreen);
        if ( dataScreen == 'undefined'){ dataScreen = 'shadowBox'} // this means that the screen that has facebook tab is the shadow box screen  //inviteScreenLayer
        var layer = dataScreen == 'eventLayer' ? 'createActivityLayer' :  dataScreen == 'groupLayer' ? 'createGroupLayer' : 'inviteScreenLayer';
       // alert(layer);

        //$( "#" + layer + " .friendToInviteContainer").html($contactsHtml.html() || gmailAuthBtn);
        yahooContacts.length > 0 ? printYahooContacts(yahooContacts) : $( "#" + layer + " .friendToInviteContainer").html(yahooAuthBtn);

    });

    // show input for a user to add friedns email
    $(' body ').on(' click ','.addEmailtoInviteBtn', function(){

        var $thisP = $(this).parent();
        var dataScreen = $thisP.parent().attr('data-screen');
        if ( dataScreen == 'undefined'){ dataScreen = 'shadowBox'} // this means that the screen that has facebook tab is the shadow box screen  //inviteScreenLayer
        var layer = dataScreen == 'eventLayer' ? 'createActivityLayer' :  dataScreen == 'groupLayer' ? 'createGroupLayer' : 'inviteScreenLayer';
        //alert( layer);
        var addEmailHtml = "<div class='row-fluid'> <div class='span8'> <input class='span12' type='text' id='friendEmailInput'/></div><div class='span4'> <span class='btn span12' data-layer='" + layer + "' id='addEmailToInvitees'> Add</span></div></div>" +
                "<div id='eMessage'></div> ";
        $( "#" + layer + " .friendToInviteContainer").html(addEmailHtml);
         //alert(layer);
    });

    $(' body ').on(' click ',' #addEmailToInvitees ', function(){
        var friendEmail = $('#friendEmailInput').val();
        //alert( friendEmail );
        var $messageContainer = $('#eMessage');
        var layer = $(this).attr('data-layer');
        if (validateEmail(friendEmail)){
            var friendNickName = friendEmail.substring(0, friendEmail.indexOf('@'));
            var $pil = $('#' + friendNickName + 'emailPilItem');
            if (!$pil.length){
                $("#" + layer+ " .friendsInvitedBar").append("<div data-e = '" + friendEmail +"' id='" + friendNickName + "emailPilItem" + "' class='pilContainerEmail'><a class='closeEmailPil'></a> " + friendNickName + "</div>");
               // alert( friendEmail );
                emailContactsInvited.push(friendEmail);
                console.log(' email contacts invited  --->[ ' + emailContactsInvited + ' ]') ;
                $messageContainer.html("<span class='alert alert-success'> " + friendEmail + " is been Added to the invitee list</span> ").fadeIn().delay(2000).fadeOut();


            }
            else {
                $messageContainer.html("<span class='alert alert-success'> Already in the invitees list</span> ").fadeIn().delay(2000).fadeOut();

            }

        }
        else {
            $messageContainer.html("<span class='alert alert-error'>not an email</span> ").fadeIn().delay(2000).fadeOut();

        }

    });

    $(' body ').on(' click ', ' .closeEmailPil ', function(){
        var $thisParent = $(this).parent();
        var closeParentId =  $thisParent.attr('id');
        var friendEmail =  $thisParent.attr('data-e');
        //var friendNickName = closeParentId.replace('emailPilItem', '');
        $thisParent.remove();
        removeItem(emailContactsInvited, friendEmail);
        console.log(' email contacts invited after remove' + emailContactsInvited) ;


    });




    //var fbFriendsFound = {};
    function searchFbFriends(fbFriednsObject, searchBy, val) {
        var searchResult = [];
        val = $.trim(val.toLowerCase());
        $.each(fbFriednsObject, function (k) {
            var fbFriendName = fbFriednsObject[k][searchBy].toLowerCase();

            if (fbFriendName.indexOf(val) != -1) {
                fbFriendName = capitalize(fbFriendName);
                searchResult.push(fbFriednsObject[k]);
            }

        });
        //LOG(searchResult);
//        alert( " Facebook friend found : " + JSON.stringify(searchResult));
        return searchResult;
    }
    function searchFavoriteTypes(favoriteTypesObject, searchBy, val) {
        var searchResult = [];
        val = $.trim(val.toLowerCase());
        $.each(favoriteTypesObject, function (k) {
            var favoriteType = favoriteTypesObject[k][searchBy].toLowerCase();

            if (favoriteType.indexOf(val) != -1) {
                favoriteType = capitalize(favoriteType);
                searchResult.push(favoriteTypesObject[k]);
            }

        });
        //LOG(searchResult);
        //alert( "Favorites Type found : " + JSON.stringify(searchResult));
        return searchResult;
    }


    //alert(screenWidth + " ...... " + layerSliderRight);
    $("body").on('click', ".event", function () {
        //alert("event clicked");
        var $this = $(this);
        hideSideMenu();
        $("#welcomeMapLayer").css('z-index', 1);
        showDetailsAndChatRoom($this, "id", eventWindowManager);
        $("#" + eventWindowManager.container + "LayerSlider").animate({
            'margin-left':eventWindowManager.layerMargin
        }, "slow", function () {
            //alert(" animation complete");
            $('div[id$="LayerSlider"]').css("margin-left", eventWindowManager.layerMargin);

            currentMarginValue = parseInt($("#" + eventWindowManager.container + "LayerSlider").css("margin-left"));
            //alert(currentMarginValue);
        });
    });

         // get the groups the user subscribed to so there will be available for invitation screen

    function getUserSubscribedGroups(){
        joynMeApiCall("GET", "comgroup/subscribed", JSON.stringify(queryString), function (localReturnedObject) {
            widget.groupToInvite = localReturnedObject.comgroupList;
        });
    }
    $('body').on('click','.comGroup', function () {
       // alert("a group layer : " + groupsWindowManager.container);
        if (groupsWindowManager.viewType == 'dualScreen'){
            $("#groupActivitiesListBackBtn").hide();
        }
        hideSideMenu();

        $("#welcomeMapLayer").css('z-index', 1);
        getAgroupDetails($(this), "id",'comGroupEvent', groupsWindowManager);
        //var $currentGroupActivities =  $('body').data('currentGroupActivities');
        //alert($('body').data('currentGroupActivities'));
       // printComGroupActivities($('body').data('currentGroupActivities'));
        //printSpecificGroup()
        $("#" + groupsWindowManager.container + "LayerSlider").animate({
            'margin-left':groupsWindowManager.layerMargin
        }, "slow", function () {
            //alert(" animation complete");
            $('div[id$="LayerSlider"]').css("margin-left", groupsWindowManager.layerMargin);

            currentMarginValue = parseInt($("#" + groupsWindowManager.container + "LayerSlider").css("margin-left"));
            //alert(currentMarginValue);
        });
    });

    // on click on a group in find group screen
    $('body').on('click','.comGroupFound', function () {
        //alert("a group layer : " + findAgroupWindowManager.container);
        if (findAgroupWindowManager.viewType == 'dualScreen'){
            $("#groupActivitiesListBackBtn").hide();
        }
        hideSideMenu();

        $("#welcomeMapLayer").css('z-index', 1);
        getAgroupDetails($(this), "id", 'comGroupFoundEvent',findAgroupWindowManager);
        //var $currentGroupActivities =  $('body').data('currentGroupActivities');
        //alert($('body').data('currentGroupActivities'));
       // printComGroupActivities($('body').data('currentGroupActivities'));
        //printSpecificGroup()
        //alert("#" + findAgroupWindowManager.container + "LayerSlider");
        $("#" + findAgroupWindowManager.container + "LayerSlider").animate({
            'margin-left':findAgroupWindowManager.layerMargin
        }, "slow", function () {
            //alert(" animation complete");
            //$('div[id$="LayerSlider"]').css("margin-left", findAgroupWindowManager.layerMargin);

            //currentMarginValue = parseInt($("#" + findAgroupWindowManager.container + "LayerSlider").css("margin-left"));
            //alert(currentMarginValue);
        });
    });

    // on click back buttton on Group Activiites Screen
    $(' body ').on(' click ', ' .backToCurrentGroup ', function(){
        //alert( " got back to group ");
        var viewType = groupsWindowManager.viewType;
        //alert(" view Type" + groupsWindowManager.viewType);
        var screenWidth = $('.screen').width();
        if (viewType === 'threeScreen'){
            $("#backToCurrentGroup").removeClass('backToCurrentGroup');
            $("#groupsLayerLayerSlider").animate({
                'margin-left' :  screenWidth
            }, function(){
               // alert(' done ');
            });

        }


    });
    //on click event on group activities list
    $(' body ').on( ' click ', ' .comGroupEvent ', function(){
        var screenWidth = $('.screen').width();
        var marginLeftV;
        $("#backToCurrentGroup").addClass('backToCurrentGroup');
        var $this = $(this);
        hideSideMenu();
        //$("#welcomeMapLayer").css('z-index', 1);
        showDetailsAndChatRoom($this, "id", groupsWindowManager);

        if (groupsWindowManager.viewType == 'oneScreen'){
            marginLeftV =  - ( 2 * screenWidth) - 5;
        }
        else {
            $("#groupActivitiesListBackBtn").show();
            marginLeftV =  - screenWidth;
            $('#groupActivitiesListBackBtn').html("<button class='joynmeBtn back'></button>");
            $("#groupActivityBackBtn").hide();
            $("#groupActivityNextBtn").show();

        }
        //alert(marginLeftValue);
        $("#groupsLayerLayerSlider").animate({
            'margin-left' : marginLeftV
        }, function(){
            //alert(' done ');
        });


    });
    //on click event on com group found activities list // find group LAyer
    $(' body ').on( ' click ', ' .comGroupFoundEvent ', function(){
       //alert(" ok go");
        var $backButton = $("#" +findAgroupWindowManager.container + "LayerSlider" + " #groupActivitiesListBackBtn");
        var $nextButton = $("#" +findAgroupWindowManager.container + "LayerSlider" + " #groupActivityNextBtn");
        var $groupActivitiesBackButton = $("#" +findAgroupWindowManager.container + "LayerSlider" + " #groupActivityBackBtn");
        var screenWidth = $('.screen').width();
        var marginLeftV;
        $("#" +findAgroupWindowManager.container + "LayerSlider" + " #backToCurrentGroup").addClass('backToCurrentGroup');
        var $this = $(this);
        hideSideMenu();
        //$("#welcomeMapLayer").css('z-index', 1);
        showDetailsAndChatRoom($this, "id", findAgroupWindowManager);

        if (findAgroupWindowManager.viewType == 'oneScreen'){
            marginLeftV =  - ( 2 * screenWidth) - 5;
        }
        else {
            $backButton.show();
            marginLeftV =  - screenWidth;
            $backButton.html("<button class='joynmeBtn back'></button>");
            $groupActivitiesBackButton.hide();
            $nextButton.show();

        }
        //alert(marginLeftValue);
        $("#" +findAgroupWindowManager.container + "LayerSlider").animate({
            'margin-left' : marginLeftV
        }, function(){
            //alert(' done ');
        });


    });


    // on keyup  on #searchComGroup
    $(' body ').on(' keyup ', '#searchComGroup', function(){
            var q = $(this).val();
            //alert(' value ' + q);

            var $containerToFill =  $("#findAGroupListContainer");
            var searchResult = searchComGroups( comGroupListObject, 'name', q);

            if (q == '') {
                //alert("it is empty");
                // $containerToFill.html(printFBFriends(activitiesType, screenType));
                printGroups('#findAGroupListContainer','comGroupFound',comGroupListObject, function(){});
            }
            else {
                if (searchResult.length != 0) {
                    //alert(" there is match");
                    // LOG(searchResult);
                    printGroups('#findAGroupListContainer',' comGroupFound',searchResult, function(){});
                    // $containerToFill.html(printFBFriends(searchResult, screenType));

                }
                else {
                    $containerToFill.html(" No match.");
                }
            }

    });

    // on click group activities

        $('body').on('click', '#groupActivitiesBtn', function(){
            var $parentLayerSlider = $(this).closest($('[id$="LayerSlider"]'));
            var layerId = $parentLayerSlider.attr('id');
            //alert(layerId);
      var screenWidth = $(".screen").width();
        var stageHeight = $("#stage").height();
        var windowWidth = $(window).width();
            $("#" + layerId).animate({
                'margin-left':- screenWidth
            }, "slow", function () {
               // alert(" animation complete");
            });

            /*
        var comGroupId = $('body').data('currentGroup').id;
             //alert( " group Id : " + comGroupId);
        var searchGroupsActivitiesHtml =" <div class='row-fluid'> <div class='span12' style='padding: 0px 4px'> <input type='text' class='span12' id='searchGroupActivities' placeholder ='Search Group Activities....'></div></div>";
        var groupActivitiesContainer = "<div class='screenTopBar' style='position: relative;text-align: center'> " +
                "<span class='h1'> Group Activities </span><div class='backBtn'><button class ='backToCurrentGroup joynmeBtn' id='cancelGroupActivitiesBtn'></button></div><div class='nextBtn'>" +
                "</div></div> " + searchGroupsActivitiesHtml + "<div id='groupActivitiesList'> .......</div>";
        // alert( "Invite Process" );
        $("#groupActivitiesLayer").remove();
        var groupActivitiesScreen = '<div class="screen" id="groupActivitiesScreen" style="right: -' + screenWidth + 'px;' +
                'z-index: 9999;position: absolute;top: 0px;height: ' + stageHeight + 'px ;width: ' + screenWidth + 'px " ></div>';
        var shadowBoxHtml = '<div class="TipShadowBox" style="position: absolute; top0px; height: ' + stageHeight + 'px ;width: ' + windowWidth + 'px " ></div>';
        var groupActivitiesLayer = "<div id='groupActivitiesLayer'> " + shadowBoxHtml + groupActivitiesScreen +"</div>";
        $("#stage").append(groupActivitiesLayer);
        $("#groupActivitiesScreen").html(groupActivitiesContainer);
        $('.screen').css('width', screenWidth);
        $("#groupActivitiesScreen").animate({
            right:0
        }, function () {
            //getComGroupActivities(comGroupId);
            var $currentGroupActivities =  $('body').data('currentGroupActivities');
            printComGroupActivities($currentGroupActivities);
        });*/
    });

    // on click group members

        $('body').on('click', '#groupMembersBtn', function(){
        var screenWidth = $(".screen").width();
        var stageHeight = $("#stage").height();
        var windowWidth = $(window).width();
        var $currentComGroupMembers = $('body').data('currentGroupMembers');

        var searchGroupsMembersHtml =" <div class='row-fluid'> <div class='span12' style='padding: 0px 4px'> <input type='text' class='span12' id='searchGroupMembers' placeholder ='Search Group Members....'></div></div>";
        var groupMembersContainer = "<div class='screenTopBar' style='position: relative;text-align: center'> " +
                "<span class='h1'> Group Members </span><div class='backBtn'><button class ='backToCurrentGroup joynmeBtn' id='cancelGroupMembersBtn'></button></div><div class='nextBtn'>" +
                "</div></div> " + searchGroupsMembersHtml+ "<div id='groupMembersListContainer'> .......</div>";
        // alert( "Invite Process" );
        $("#groupMembersLayer").remove();
        var groupMembersScreen = '<div class="screen" id="groupMembersScreen" style="right: -' + screenWidth + 'px;z-index: 9999;position: absolute;top: 0px;height: ' + stageHeight + 'px ;width: ' + screenWidth + 'px " ></div>';
        var shadowBoxHtml = '<div class="TipShadowBox" style="position: absolute; top0px; height: ' + stageHeight + 'px ;width: ' + windowWidth + 'px " ></div>';
        var groupMembersLayer = "<div id='groupMembersLayer'> " + shadowBoxHtml + groupMembersScreen + "</div>";
        $("#stage").append(groupMembersLayer);
        $("#groupMembersScreen").html(groupMembersContainer);
        $('.screen').css('width', screenWidth);

        $("#groupMembersScreen").animate({
            right:0
        }, function () {
            var $comGroupMembersContainer = $("#groupMembersListContainer");
            var comGroupMembersHtml = getComGroupMembersHtml($currentComGroupMembers);
            if (comGroupMembersHtml) {
                $comGroupMembersContainer.html(comGroupMembersHtml);
            }
            else {
                $comGroupMembersContainer.html(" No members at this moment.");

            }
        });
    });
    //
    function getComGroupMembersHtml(comGroupMembers){

            //alert(JSON.stringify(comGroupMembers));
            var comGroupMembersHtml = "<div class='row-fluid'><ul>";
            var comGroupMemberImg = "";
            var comGroupMemberName = "";
            var comGroupMemberItemId;
            if (!comGroupMembers.length){
                return 0;
            }
            comGroupMembersHtml += '<div class="span12 lightGreen dateSeparator screenTopBar" >Administrators</div>';

            $.each(comGroupMembers, function(t){
                if (comGroupMembers[t].userLevel == 2){
                    comGroupMemberImg = comGroupMembers[t].user.pictureUrl != null ? comGroupMembers[t].user.pictureUrl : "https://graph.facebook.com/"+ comGroupMembers[t].user.facebookId + "/picture";
                    comGroupMemberName = comGroupMembers[t].user.first + ' ' + comGroupMembers[t].user.last;
                    comGroupMemberItemId = comGroupMembers[t].user.id;
                   comGroupMembersHtml += " <li class='comGroupMemberItem' style='border-bottom: 1px solid #e1e1e1'> <img style='max-width: 12%; height: 40px' src = ' " + comGroupMemberImg + "' />  " +
                         "<span><a class='groupAdminFate eventTitle' id='"+comGroupMemberItemId+"'> " + comGroupMemberName + "</a></span></li><hr style='margin: 0px; border-top: none'>";
                }
            });

            comGroupMembersHtml += '<div style=margin-left:0px;" class="span12 lightGreen dateSeparator screenTopBar">Members</div>';

            $.each(comGroupMembers, function(k){
            if (comGroupMembers[k].userLevel == 1){

                comGroupMemberImg = comGroupMembers[k].user.pictureUrl != null ? comGroupMembers[k].user.pictureUrl : "https://graph.facebook.com/"+ comGroupMembers[k].user.facebookId + "/picture";
                comGroupMemberName = comGroupMembers[k].user.first + ' ' + comGroupMembers[k].user.last;
                comGroupMemberItemId = comGroupMembers[k].user.id;

                comGroupMembersHtml += " <li class='comGroupMemberItem' style='border-bottom: 1px solid #e1e1e1'> <img style='max-width: 12%; height: 40px' src = ' " + comGroupMemberImg + "' />  " +
                        "<span ><a class='groupMemberFate eventTitle' id='"+comGroupMemberItemId+"'> " + comGroupMemberName + "</a></span></li><hr style='margin: 0px; border-top: none'>";
            }
            });


        comGroupMembersHtml += "</ul></div>";
            //  alert(comGroupMembersHtml);

            return comGroupMembersHtml;

    }


    //for admin members

    $('body').on('click','.groupAdminFate',function(){
        var comGroupMemberItemId = this.id;

        var signUpHtml = '<div style="z-index:9999;"   id="signUpContainer">' +
                '<div id="signUpWrapper" style=" width: ' + screenWidth + 'px' + '" >' +
                '<div class="modal-header textCenter"> ' +
                '<h5>Group Member Options</h5>' +
                '</div>' +
                '<div class="modal-body">' +
                '<div class="row-fluid textCenter">' +
                '<button style="background-color:red" class="btn btn-success-red" id="downgradeAdminBtn" data-event="'+comGroupMemberItemId+'">Downgrade Admin To Member</button>' +
                '</div> ' +
                '<hr class="hr" > ' +
                '<div  class="row-fluid">' +
                '<button id="closeAdminFate" >Close</button>' +
                '</div> ' +
                '</div>' +
                '</div>' +
                '</div>';
        var signUpLayer = "<div id='defineMemberFate'>" + signUpHtml + "</div>";

        if (userIsAdmin){
            $("#widget").append(signUpLayer);
        }


        $('body').on('click',"#downgradeAdminBtn",function(){

            var members = $('body').data('currentGroupMembers');


            var  numberOfAdmins = 0;
            var selfId = "";
            var tokenO = {};
            tokenO.token = queryString.token;

            joynMeApiCall("GET", '/user/' , JSON.stringify(tokenO), function (localReturnedObject) {
                selfId = localReturnedObject.user.id;
            });


            $.each(members, function(j){
                if (members[j].userLevel == 2){
                    numberOfAdmins = numberOfAdmins + 1;
                }
            });

           // alert(numberOfAdmins);

            if (numberOfAdmins > 1 ){
            downgradeAdmin(numberOfAdmins, selfId);

            }else{
                showMessageToUser("You are the only admin, who will drive?", "alert-error");
            }

            $("#signUpContainer").remove();
            //$('#groupMembersLayer').remove();

            $('#' + comGroupId).trigger('click');
            $('#groupMembersBtn').trigger('click');

        });

     function downgradeAdmin(numberOfAdmins, selfId){

            var tokenO = {};
            tokenO.token = queryString.token;
            var comGroupMemberItemId =  $("#downgradeAdminBtn").attr("data-event");

                joynMeApiCall("PUT", 'comgroup/id/' +comGroupId+ '/admin/user/'+comGroupMemberItemId+ '/level/1' , JSON.stringify(tokenO), function () {
                   showMessageToUser("User downgraded!", "alert-success");
                });

            $("#signUpContainer").remove();
         //   $('#groupMembersLayer').remove();
    }


    $('body').on('click',"#closeAdminFate",function(){
       $("#signUpContainer").remove();
    });


    });

//for regular members



    $('body').on('click','.groupMemberFate',function(){
        var comGroupMemberItemId = this.id;


        var signUpHtml = '<div style="z-index:9999;"   id="signUpContainer">' +
                '<div id="signUpWrapper" style=" width: ' + screenWidth + 'px' + '" >' +
                '<div class="modal-header textCenter"> ' +
                '<h5>Group Member Options</h5>' +
                '</div>' +
                '<div class="modal-body">' +
                '<div class="row-fluid textCenter">' +
                '<button class="myBtn btn btn-success" id="upgradeToAdminBtn" data-event="'+comGroupMemberItemId+'" >  Upgrade To Admin  </button>' +
                '</div>' +
                '<hr class="hr" > ' +
                '<div class="row-fluid textCenter">' +
                '<button style="background-color:red" class="btn btn-success-red" id="removeFromGroupBtn" data-event="'+comGroupMemberItemId+'">Remove From Group</button>' +
                '</div> ' +
                '<hr class="hr" > ' +
                '<div  class="row-fluid">' +
                '<button id="closeDefineMemberFate" >Close</button>' +
                '</div> ' +
                '</div>' +
                '</div>' +
                '</div>';
        var signUpLayer = "<div id='defineMemberFate'>" + signUpHtml + "</div>";

        if (userIsAdmin){
        $("#widget").append(signUpLayer);
        }




        $('body').on('click',"#upgradeToAdminBtn",function(){

            var tokenO = {};
            tokenO.token = queryString.token;
            var comGroupMemberItemId =  $("#upgradeToAdminBtn").attr("data-event");
            joynMeApiCall("PUT", 'comgroup/id/' +comGroupId+ '/admin/user/'+comGroupMemberItemId+ '/level/2' , JSON.stringify(tokenO), function () {
                showMessageToUser("User upgraded to administrator!", "alert-success");

            });

            $("#signUpContainer").remove();
            $('#' + comGroupId).trigger('click');

            $('#groupMembersBtn').trigger('click');
           // $('#' + comGroupId).trigger('click');

        });

        $('body').on('click',"#removeFromGroupBtn",function(){

            var tokenO = {};
            tokenO.token = queryString.token;
            var comGroupMemberItemId =  $("#removeFromGroupBtn").attr("data-event");

            joynMeApiCall("PUT", 'comgroup/id/' +comGroupId+ '/admin/user/'+comGroupMemberItemId+ '/level/0' , JSON.stringify(tokenO), function () {
                showMessageToUser("User removed from group!", "alert-success");

            });

            $("#signUpContainer").remove();
          //  $('#groupMembersLayer').remove();
            $('#' + comGroupId).trigger('click');
        });





        $('body').on('click',"#closeDefineMemberFate",function(){
            $("#signUpContainer").remove();
        });

    });







    // close group activites screen
    $('body').on('click', '#cancelGroupActivitiesBtn', function(){
        var screenWidth = $(".screen").width();
        $(".TipShadowBox").fadeOut();
        var $groupActivitiesLayer =  $("#groupActivitiesLayer");
        if ($groupActivitiesLayer.length){
            $('#groupActivitiesScreen').animate({
                'right' : -screenWidth + "px"
            }, function(){
                 $groupActivitiesLayer.remove();
            });
        }
    });
    // close group mebers screen
    $('body').on('click', '#cancelGroupMembersBtn', function(){
        var screenWidth = $(".screen").width();
        $(".TipShadowBox").fadeOut();
        var $groupMembersLayer =  $("#groupMembersLayer");
        if ($groupMembersLayer.length){
            $('#groupMembersScreen').animate({
                'right' : -screenWidth + "px"
            }, function(){
                 $groupMembersLayer.remove();
            });
        }
    });


    // search through comGroups
    function searchComGroups(comGroupsObject, searchBy, val) {
        //alert(JSON.stringify(comGroupListObject));
        var searchResult = [];
        val = $.trim(val.toLowerCase());
        $.each(comGroupsObject, function (k) {
            var favoriteType = comGroupsObject[k][searchBy].toLowerCase();

            if (favoriteType.indexOf(val) != -1) {
                favoriteType = capitalize(favoriteType);
                searchResult.push(comGroupsObject[k]);
            }

        });
        //LOG(searchResult);
        //alert( "Favorites Type found : " + JSON.stringify(searchResult));
        return searchResult;
    }


    // get a group Details
    function getAgroupDetails(selector,attr,comGroupEventclass, wManager){
        var id = $(selector).attr(attr);
        //alert( " group Id : " + id);
        if (id == "undefined"){
            alert("Group ID : " + id);
        }
        else {
            getAgroupDetailsWithId(id,comGroupEventclass, wManager);
        }
    }


    // get A list of default groups

    function getListOfComGroup(){
        var tokenObject = {'token':queryString.token, "limit":100};
        var groupsListObject;
        joynMeApiCall("GET", "/comgroup", JSON.stringify(tokenObject), function () {
            //alert(JSON.stringify(apiReturnedObject.eventList));
            comGroupListObject = apiReturnedObject.comgroupList;
            printGroups('#findAGroupListContainer','comGroupFound',comGroupListObject, function(){

            });
            groupsListObject = apiReturnedObject.comgroupList;

        });

    }




    // attending event button
    $(".attendEventBtn").live('click', function () {
        var token = queryString.token;
        var eventId = eventDataObject.event.id;
        var o = {"token":token, "interest":3};
        //alert(JSON.stringify(o));
        joynMeApiCall("PUT", "event/id/" + eventId + '/self/attending', JSON.stringify(o), function () {

        });
    });
    // not attending event button
    $(".noAttendEventBtn").live('click', function () {
        var token = queryString.token;
        var eventId = eventDataObject.event.id;
        var o = {"token":token, "interest":0};
        //alert(JSON.stringify(o));
        joynMeApiCall("PUT", "event/id/" + eventId + '/self/attending', JSON.stringify(o), function () {
        });
    });
    // following event button
    $(".followEventBtn").live('click', function () {
        var token = queryString.token;
        var eventId = eventDataObject.event.id;
        var o = {"token":token, "interest":2};
        //alert(JSON.stringify(o));
        joynMeApiCall("PUT", "event/id/" + eventId + '/self/attending', JSON.stringify(o), function () {
        });
    });

    $("#goToMap").live('click', function () {
        // inputFocus();
        //printFriendsInviteScreen();

        $("#" + createActivityWindowManager.container + "LayerSlider").animate({
            'margin-left':createActivityWindowManager.layerMargin
        }, "slow", function () {
            //alert(" animation complete");
            $('div[id$="LayerSlider"]').css("margin-left", createActivityWindowManager.layerMargin);
            //alert(createActivityWindowManager.layerMargin);
            currentMarginValue = parseInt($("#" + eventWindowManager.container + "LayerSlider").css("margin-left"));
            //inputFocus();

            //alert(currentMarginValue);
        });
    });
    // on click Agenda history and Joyned buttons
    $("#agendaHistoryBtn").live('click', function () {
        //alert(" History");
        var tokenObject = {'token':queryString.token, "limit":100};
        joynMeApiCall("GET", "/agenda/history", JSON.stringify(tokenObject), function (localReturnedObject) {
            printAgenda(localReturnedObject.eventList, agendaWindowManager, 'history');
        });

    });
    $("#agendaJoynedBtn").live('click', function () {
        //alert(JSON.stringify(agendaJoynedObject));
        printAgenda(agendaJoynedObject, agendaWindowManager);
    });
    $(".forwardToMapScreen").live('click', function () {
        $("#welcomeMapLayer").css('z-index', 3);
    });


    $(" body ").on('click',".getEvents",  function () {
        $('.TipShadowBox').trigger('click');
        hideSideMenu();
        $("#sideMenuUl li").css('background-color', '');
        var li = ($(this).parent());
        li.css('background-color', '#747474');
        $("#secondaryBar").slideDown();
        resetPosition(eventWindowManager.stageWidth);
        //alert("events");
        joynMeApiCall("GET", "event", JSON.stringify(queryString), function (localReturnedObject) {
            var allEventsList = localReturnedObject.eventList;
            printEvents( allEventsList , "#eventsListContainer", 'event', 'time');
            //printEvents(apiReturnedObject.eventList, "#eventsListContainer", 'event', 'distanceStr');
            clearMarkers(markersArray);
            getAllEvents("event", JSON.stringify(queryString), 'event');
            initBinding();
        });
        $("#eventLayer").css('z-index', '1');
        //$('.gLayer').css('position' ,'absolute');
        if (eventWindowManager.viewType == "oneScreen") {
            $("#welcomeMapLayer").css('z-index', 1);
        }
        else {
            $("#welcomeMapLayer").css('z-index', 2);
        }
        $("#" + eventWindowManager.container + "List").animate({
            'margin-left':0
        }, function () {

        });
        //resetPosition();
        // $(".fullLayer:not('#eventsLayer')").css('z-index', '0');

        /* $("#welcomeMapLayer").css({
         'width':'70%', 'right':'0'
         });
         google.maps.event.trigger(widget.map, "resize");
         widget.map.setCenter(userLocation.location)*/
    });

    $(".close").live('click', function () {
        // get the slider Container where it belong to
        var screenWidth = $(".screen").width();
        var containerToSlider = $(this).closest($('[id$="LayerSlider"]')).attr("id");
        if (eventWindowManager.viewType == "threeScreen") {

            marginValue = currentMarginValue + screenWidth;
        }
        else if (eventWindowManager.viewType == "dualScreen") {
            marginValue = currentMarginValue + screenWidth;
        }
        else {
            marginValue = currentMarginValue + (screenWidth * 2);
        }
        $("#" + containerToSlider).animate({
            'margin-left':marginValue
        }, "slow", function () {
            //alert(" animation complete");
            $(".close").hide();
            currentMarginValue = parseInt($("#" + containerToSlider).css("margin-left"));
            //alert(currentMarginValue);
        });
    });
    // console.log("Back buton : " + $("#notificationLayer .back").closest($('[id$="LayerSlider"]')).attr("id"));

    $('body').on('click', '.back', function () {
        var $parentLayerSlider = $(this).closest($('[id$="LayerSlider"]'));
        var layerId = $parentLayerSlider.attr('id');
        var marginV;
        currentMarginValue = parseInt($parentLayerSlider.css("margin-left"));
        var screenWidth = $(".screen").width();
        var screenPadding = parseInt($(".screen").css("padding"));
        //var containerToSlider = $(this).closest($('[id$="LayerSlider"]')).attr("id");
        if (eventWindowManager.viewType == "dualScreen") {
            //alert(' dual screen currentMarginValue: ' + currentMarginValue);
            if (currentMarginValue < -5 ) {
                marginV = currentMarginValue + (screenWidth);
                if (-(currentMarginValue) > (screenWidth * 2)){


                    $("#" + layerId +  " #groupActivitiesListBackBtn").show();
                }
                else {
                    $("#" + layerId +  " #groupActivitiesListBackBtn").hide();
                }
                $("#" + layerId +  " #groupActivityBackBtn").hide();

            }
            else {
                marginV = currentMarginValue + (screenWidth * 2) + 4;

            }
        }
        else if (eventWindowManager.viewType == "oneScreen") {
            //alert(' one screen currentMarginValue: ' + currentMarginValue);

            //alert( currentMarginValue);
            marginV = currentMarginValue + screenWidth + 2;
        }
        else {
            //alert(' three screens currentMarginValue: ' + currentMarginValue);

            $("#" + layerId + ' #groupActivitiesListBackBtn').hide();
            marginV = currentMarginValue + (screenWidth * 2) + 4;

        }
        //alert(marginValue);
        //$("#" + containerToSlider).css('border', 'solid 5px red');
        //alert(marginV);
        $parentLayerSlider.animate({
            'margin-left':marginV
            //'margin-left':200
        }, "slow", function () {
            currentMarginValue = parseInt($parentLayerSlider.css("margin-left"));
            if (currentMarginValue >= screenWidth * 2) {
                $("#welcomeMapLayer").css('z-index', 2);

            }

        });
    });
    $(' body ').on('click', '.forward', function () {
         var marginV;
        var $parentLayerSlider = $(this).closest($('[id$="LayerSlider"]'));
        var layerId = $parentLayerSlider.attr('id');


        currentMarginValue = parseInt($parentLayerSlider.css("margin-left"));
        var screenWidth = $(".screen").width();
        var screenPadding = parseInt($(".screen").css("padding"));
        if (eventWindowManager.viewType == "dualScreen") {
            marginV = currentMarginValue - (screenWidth + 5);
            $("#" + layerId + " #groupActivityBackBtn").html("<button class='joynmeBtn back'></button>").show();
            $("#" + layerId + " #groupActivityNextBtn").hide();
        }
        else if (eventWindowManager.viewType == "oneScreen") {
            //alert( currentMarginValue);
            marginV = currentMarginValue - screenWidth;
        }
        //alert(marginValue);
        //$("#" + containerToSlider).css('border', 'solid 5px red');
        $parentLayerSlider.animate({
            'margin-left':marginV
            //'margin-left':200
        }, "slow", function () {

            //$('#' + layerId).css("margin-left", marginV);

            currentMarginValue = parseInt($parentLayerSlider.css("margin-left"));
            //alert(currentMarginValue);
        });

    });
    $(".forwardToInviteScreen").live('click', function () {
        // console.log($(this).closest($('[id$="LayerList"]')).attr('id'));
        var listContainerId = $(this).closest($('[id$="LayerList"]')).attr('id');
        var sliderContainer = listContainerId.substr(0, listContainerId.length - 4) + "LayerSlider";
        //alert(sliderContainer);
        $("#" + sliderContainer).animate({
            'margin-left':0
        }, "slow", function () {
            //alert("done");
            // alert(currentMarginValue);
            //alert(" animation complete");
        });
    });

    $(".detailsLink").live('click', function () {
        //alert(" Detail lik clicked");
        var containerToSlider = $(this).closest($('[id$="LayerSlider"]')).attr("id");
        if (eventWindowManager.viewType == "threeScreen") {
            marginValue = 0;

        }
        else if (eventWindowManager.viewType == "dualScreen") {
            marginValue = -eventWindowManager.screenWidth;
        }
        else {
            marginValue = -eventWindowManager.screenWidth * 2;
        }
        //alert(eventWindowManager.screenWidth);
        $("#" + containerToSlider).animate({
            'margin-left':marginValue
        }, "slow", function () {
            $(".close").show();
            currentMarginValue = parseInt($("#" + containerToSlider).css("margin-left"));
            //alert(currentMarginValue);
            //alert(" animation complete");
        });
    });

    //
    $("#getListByDistance").live('click', function () {
        //alert("distance");
        // $(this).addClass('active');
        // $("#getListByTime").removeClass('active');
        // $('#sortActivitiesBtn').tooltip('hide');
        printEvents(eventsListData, "#eventsListContainer", 'event', 'distanceStr');

    });

    $("#getListByTime").live('click', function () {
        //alert("time");
        //$(this).addClass('active');
        //$("#getListByDistance").removeClass('active');
        //$('#sortActivitiesBtn').tooltip('hide')
        printEvents(eventsListData, "#eventsListContainer", 'event', 'time');

    });
    // validation
    $(".inputV").live('click', function () {
        $(this).val("");
        $(this).removeClass('inputV');

    });

    // side menu Toggle
    $('body').on('click', '.sliderToggle',function () {
        var sliderMarginValue = parseInt($('div[id$="LayerSlider"]').css("margin-left"));
        var sideMenuDifference = 94;
        // alert(sliderMarginValue);
        var sideMenuWidth = $("#sideMenu").width();
        var screenWidth = $(".screen").width();
        var w;
        LOG(sideMenuWidth);
        if (sideMenuWidth == 0) {   // open the side menu
            w = 127;
            screenWidth = screenWidth - widthToToggle;
            if (sliderMarginValue == 0) {
                sliderMarginValue = 0
            }
            else {
                if (sliderMarginValue < 0) {
                    sliderMarginValue = sliderMarginValue - sideMenuDifference;

                }
                else {
                    sliderMarginValue = sliderMarginValue - sideMenuDifference;
                }
            }
        }
        else {
            w = 0; // close the side menu
            screenWidth = screenWidth + widthToToggle;
            if (sliderMarginValue == 0) {
                sliderMarginValue = 0;
            }
            else {
                if (sliderMarginValue < 0) {
                    sliderMarginValue = sliderMarginValue + sideMenuDifference;

                }
                else {
                    sliderMarginValue = sliderMarginValue + sideMenuDifference;
                }
            }
        }
        $("#sideMenu").show().animate({
                    width:w
                }, 'slow', function () {

                }
        );
    });

    // Call Notification Count;
    joynMeApiCall("GET", "notifications/general/count", JSON.stringify(queryString), function (d) {
        printNotificationCount(d);
    });


    // pre-toggle buttons
    //$("#getWelcomeMap, #getAgendaAttending, #getListByDistance").button('toggle');
    function callNotification() {
        joynMeApiCall("GET", "notifications/general/count", JSON.stringify(queryString), function (localReturnedObject) {
            printNotificationCount(localReturnedObject);
            joynMeApiCall("GET", "notifications/general/", JSON.stringify(queryString), function (localReturnedObject2) {
                printNotification(localReturnedObject2.generalNotificationList, notificationWindowManager);
            });
        })
    }

    //  call for notification every 10 second
    //setInterval(callNotification, 30000);
    //alert(userLocation.lat);

    var afterGeoIpLoads = function()
    {
        // set these globals which are defined in api.js
        userLocation.lat = GeoIP.geoip_latitude();
        userLocation.lng = GeoIP.geoip_longitude();

        userLocation.location = new google.maps.LatLng(userLocation.lat, userLocation.lng);
        initialize(userLocation.location);
        getAllEvents('event', JSON.stringify(queryString), 'event');
    };

	// This is a wrapper around the GeoIP javascript file
	// It will cache the results making the Widget load times much faster
    GeoIP.callback = afterGeoIpLoads;
    GeoIP.start();


    // reset all layer positions
    //resetPosition();
    // bootsrap pop over
    $('#getAccount').live('click', function () {
        $(this).popover({
            animation:true,
            title:'Account Information',
            html:true,
            placement:'right',
            trigger:'click',
            content:"And here goes account setting"
        });
    });


    $("#getWelcomeMap").live('click', function () {
        $("#secondaryBar").slideDown();
        resetPosition(eventWindowManager.stageWidth);

        $("#" + eventWindowManager.container + "List").animate({'margin-left':-eventWindowManager.screenWidth});
        $("#" + notificationWindowManager.container + "List").animate({'margin-left':-notificationWindowManager.screenWidth});
        $("#" + agendaWindowManager.container + "List").animate({'margin-left':-agendaWindowManager.screenWidth}, function () {
            $("#welcomeMapLayer").css('z-index', '1');
        });
    });


    var calNotifications = function () {
        hideSideMenu();
        if (eventWindowManager.viewType == "oneScreen") {
            $("#welcomeMapLayer").css('z-index', 1);
        }
        else {
            $("#welcomeMapLayer").css('z-index', 2);
        }
        resetPosition(notificationWindowManager.stageWidth);
        //$("#secondaryBar").slideUp();
        joynMeApiCall("GET", "notifications/general/", JSON.stringify(queryString), function (localReturnedObject) {
            printNotification(localReturnedObject.generalNotificationList, notificationWindowManager);
            clearMarkers(markersArray);
            getAllEvents("event", JSON.stringify(queryString), 'notificationMapItem');
            initBinding();
        });

        //$("#welcomeMapLayer").css('z-index', '1');
        $("#notificationLayer").css('z-index', '1');
        $("#" + notificationWindowManager.container + "List").animate({
            'margin-left':0
        });
    }


    //

    var agendaJoynedObject = "";
    var calAgenda = function () {
        hideSideMenu();
        resetPosition(eventWindowManager.stageWidth);
        joynMeApiCall("GET", "agenda", JSON.stringify(queryString), function (localReturnedObject) {
            printAgenda(localReturnedObject.eventList, agendaWindowManager);
            agendaJoynedObject = localReturnedObject.eventList;
            clearMarkers(markersArray);
            getAllEvents("event", JSON.stringify(queryString), 'agendaItem');
            // populateWelcomeMap(agendaJoynedObject);
        });
        //$("#welcomeMapLayer").css('z-index', '0');
        //$("#welcomeMapLayer").css('z-index', '1');
        $("#agendaLayer").css('z-index', '1');
        $("#" + agendaWindowManager.container + "List").animate({
            'margin-left':0
        }, function () {
            if (eventWindowManager.viewType != "oneScreen") {
                $("#welcomeMapLayer").css('z-index', 2);
            }
        });
    }


    var calCreateActivitySteps = function () {
        // t4.showToolTip('click');
        hideSideMenu();
        resetPosition(eventWindowManager.stageWidth);
        //$("#secondaryBar").slideUp();
        getUserSubscribedGroups();
        printCreateActivityStepOne(function () {
            var today = new Date();
            var todayDateAndTime = today.toString("M/d/yyyy HH:mm tt");
            var todayPlusTwoHours = today.addHours(2).toString("M/d/yyyy HH:mm tt");
            $("#startDateTime").val(todayDateAndTime);
            $("#endDateTime").val(todayPlusTwoHours);
            //$("#startDateTime, #endDateTime").calendar();
            $(".dateAndTime").datetimepicker({
                controlType:'select',
                timeFormat:'hh:mm tt',
                showTime:false,
                stepMinute:15
            });

            $('.dateAndTime').attr("readonly", false);


            t2.showToolTip('hover');
            //t3.showToolTip('click');

        });
        // get invite friends screen
        // alert(planSliderMargin);
        $("#" + createActivityWindowManager.container + "LayerSlider").animate({
            'margin-left':planSliderMargin
        }, "slow", function () {
            //alert(" animation complete");
            // $('div[id$="LayerSlider"]').css("margin-left", planSliderMargin);
            //alert(createActivityWindowManager.layerMargin);
            currentMarginValue = parseInt($("#" + eventWindowManager.container + "LayerSlider").css("margin-left"));
            // inputFocus();

            //alert(currentMarginValue);
        });
        $("#welcomeMapLayer").css('z-index', '0');
        //$("#favoritesLayer").css('z-index' , '1');
        $("#" + createActivityWindowManager.container + "List").animate({
            'margin-left':0
        });
        //initialize the activities input box auto complete
        $("#inputActivity").autocomplete({
            source:activitiesType,
            minLength:0,
            select:function (event, ui) {
                //alert(JSON.stringify(ui));
                planedEvent.event.activityId = ui.item.id;
                //alert(planedEvent.event.activityId);

            }
        }).focus(function () {
                    $(this).autocomplete('search', $(this).val())
                });

        //

    }

    //
    function unFavorite(elemId){
       // alert("#favoriteType" + elemId);
        userActivitiesList[elemId] = false;
        $("#img" + elemId).attr('src', 'images/grayStar.png');
        $("#favoriteType" + elemId).remove();
        $("#favoriteItem" + elemId).attr('data-selected', '')
        joynMeApiCall("DELETE", "favoriteActivity/id/" + elemId, JSON.stringify({'token':queryString.token}), function () {
        });
    }
    function makeFavorite(elemId){
        userActivitiesList[elemId] = true;
        $("#favoriteItem" + elemId).attr('data-selected', 'selected');
        $("#img" + elemId).attr('src', 'images/goldenStar.png');
        joynMeApiCall("PUT", "favoriteActivity/id/" + elemId, JSON.stringify({'token':queryString.token}), function () {
        });
    }

    // on create a group button
    createdGroup.comgroup.privacy = "PUBLIC";

    $(' body ').on(' click ', ' #createGroupBtn ', function(){
        var r = false;
        var $groupName = $("#inputGroupName");
        var $groupDescription = $("#inputGroupDescription");
        var $groupUrl = $("#inputGroupWebSite");
        var $groupTerritory = $("#inputGroupTerritory");
        var $publicGroupBtn = $("#publicGroupBtn");
        createdGroup.token = queryString.token;
        createdGroup.comgroup.name = $groupName.val() != '' ?  $groupName.val() : r = validateGroupInput($groupName);

        var privacy = $("#publicGroupBtn").hasClass('active') ? 'PUBLIC' : 'PRIVATE'
        var vis = $("#visibleGroupBtn").hasClass('active'); // ? 'VISIBLE' : 'INVISIBLE'
        if (vis){
            vis = "VISIBLE";
        }else{
            vis = "INVISIBLE";
        }

        if ((privacy == 'PRIVATE') && (vis == 'VISIBLE')){
            createdGroup.comgroup.privacy = 'PRIVATE_VISIBLE';

        }else if ((privacy == 'PRIVATE') && (vis == 'INVISIBLE')){
            createdGroup.comgroup.privacy = 'PRIVATE_INVISIBLE';
        }else{
            createdGroup.comgroup.privacy = 'PUBLIC';
        }
     //   alert(JSON.stringify(createdGroup.comgroup.privacy));

        createdGroup.comgroup.description = $groupDescription.val();
        createdGroup.comgroup.url = $groupUrl.val();
        createdGroup.comgroup.territory = $groupTerritory.val();
        //alert(r);
        if (!r){
            joynMeApiCall("POST", "comgroup", JSON.stringify(createdGroup), function(localReturnedObject){
                var comGroupId = localReturnedObject.comgroup.id;
                var pictureUrl = apiBaseUrl + 'comgroup/id/' + comGroupId + '/picture/0';
                //alert(pictureUrl);
                postImage("#comGroupImgFile",queryString.token, pictureUrl, "windowSize" );
                showGroupDetails(comGroupId, 'comGroup');
                sendInvites('group',comGroupId, fbFriendInvited,TFollowersInvited, groupFriendInvited,gmailContactsInvited,yahooContactsInvited,emailContactsInvited);



            });

        }
    });

    //
    function showGroupDetails(comGroupId, groupClass){
        //alert("ID: " + comGroupId);
        joynMeApiCall("GET", "comgroup/subscribed", JSON.stringify(queryString), function () {
            widget.groupToInvite = apiReturnedObject.comgroupList;
            printGroups('#groupsListContainer',groupClass,apiReturnedObject.comgroupList, function(){
                showMessageToUser("Group Created Successfully", 'alert-success');
                $("#groupsLayer").css('z-index', 1);
                $("#" + groupsWindowManager.container + "List").animate({
                    'margin-left':0
                }, function(){
                    console.log($("#" + comGroupId));
                    $("#" + comGroupId).trigger( 'click' );

                });
                $("#createGroupLayer").animate({
                    'margin-left':- $( window).width()
                });

            });
        });


        /*alert(JSON.stringify(apiReturnedObject));
        var comGroupId = apiReturnedObject.comgroup.id;
        alert(" ID " +  comGroupId);
        $('#getGroups').trigger( 'click');
        console.log($("#" + comGroupId));
        alert($("#" + comGroupId).length);
        $("#" + comGroupId).trigger( 'click');*/
    }



    // on clicking an activity type

    $("body").on(' click ', ".favoriteItem", function(){

        var elemId =$(this).attr('id').replace('favoriteItem', '');
        /*alert($("#favoriteType" + elemId).attr("id"));
        console.log($("#myFavoritesList"));
        if ($("#myFavoritesList li #" + elemId).attr("id") == elemId){
            alert(" it is in the screen");
        }*/
        var activityTypeText = $("#activityTypeText" + elemId).text();
        var elem = "<li class='as-selection-item myFavorite' id='favoriteType" + elemId + "'> <a class='as-close'></a>" + activityTypeText + "</li>";

        if ($(this).attr('data-selected')){  // if it is a user favorite , unfavorite it
            unFavorite(elemId);
            //userActivitiesList[elemId] = false;
            //$("#img" + elemId).attr('src', 'images/grayStar.png');
        }
        else {
            makeFavorite(elemId);
            $("#myFavoritesList").append(elem);

        }

        console.log(JSON.stringify(userActivitiesList));

    });



    var calFavorites = function () {
        hideSideMenu();
        resetPosition(eventWindowManager.stageWidth);
        $("#welcomeMapLayer").css('z-index', '1');
        //$("#secondaryBar").slideUp();
        joynMeApiCall("GET", "favoriteActivity", JSON.stringify(queryString), function (localReturnedObject) {
            printFavorites(localReturnedObject.activityResultList, function () {
                // clear th emap and populate the map with favorites activiites markers
                printActivitiesType(activitiesType);

            });
        });
        $("#" + favoritesWindowManager.container + "List").animate({
            'margin-left':0
        });
        $("#" + favoritesWindowManager.container + "LayerSlider").animate({
            'margin-left':planSliderMargin
        }, "slow", function () {
            currentMarginValue = parseInt($("#" + eventWindowManager.container + "LayerSlider").css("margin-left"));
        });


    }
    var calGroups = function () {
        /*var $searchComGroup = $("#searchComGroup");
        if ($searchComGroup.length){
            $searchComGroup.parent().remove();
        }*/
        $("#createGroupShowLayer").removeClass('active');
        $("#findGroupBtn").removeClass('active');
        hideSideMenu();
        resetPosition(groupsWindowManager.stageWidth);
        $("#welcomeMapLayer").css('z-index', '1');

        joynMeApiCall("GET", "comgroup/subscribed", JSON.stringify(queryString), function () {
            widget.groupToInvite = apiReturnedObject.comgroupList;
			initBinding();
            printGroups('#groupsListContainer','comGroup', apiReturnedObject.comgroupList, function(){

            });
        });

        $("#" + groupsWindowManager.container + "List").animate({
            'margin-left':0
        });
        /*$("#" + groupsWindowManager.container + "LayerSlider").animate({
            'margin-left':planSliderMargin
        }, "slow", function () {
            currentMarginValue = parseInt($("#" + eventWindowManager.container + "LayerSlider").css("margin-left"));
        });*/
    }


    var createAGroup = function(){
        hideSideMenu();
        //resetPosition(createGroupWindowManager.stageWidth);
        $("#welcomeMapLayer").css('z-index', '1');
        printCreateAGroupStepOne(function(){
           // alert(" done creating step one screen");
            $("#" + createGroupWindowManager.container + "LayerSlider").animate({
                'margin-left':planSliderMargin
            }, "slow", function () {
                //alert(" animation complete");
                // $('div[id$="LayerSlider"]').css("margin-left", planSliderMargin);
                //alert(createActivityWindowManager.layerMargin);
                currentMarginValue = parseInt($("#" + eventWindowManager.container + "LayerSlider").css("margin-left"));
        });
        });
        /*joynMeApiCall("GET", "comgroup/subscribed", JSON.stringify(queryString), function () {
            printGroups(apiReturnedObject.comgroupList, function(){

            });
        });*/

        $("#" + createGroupWindowManager.container + "List").animate({
            'margin-left':0
        });
    }

    var findAGroup = function(){
        hideSideMenu();
        $('[id$="LayerSlider"]').animate({
            'margin-left':$(window).width()
        }, 'slow', function () {
            // $("#welcomeMapLayer").css('z-index', '1');
        });
        $("#welcomeMapLayer").css('z-index', '1');
       /* $("#" + findAgroupWindowManager.container + "LayerSlider").animate({
                'margin-left':planSliderMargin
            }, "slow", function () {
                //alert(" animation complete");
                // $('div[id$="LayerSlider"]').css("margin-left", planSliderMargin);
                //alert(createActivityWindowManager.layerMargin);
           //getListOfComGroup();
           currentMarginValue = parseInt($("#" + eventWindowManager.container + "LayerSlider").css("margin-left"));
        });*/


        $("#" + findAgroupWindowManager.container + "List").animate({
            'margin-left':0
        }, 'slow', function(){
            getListOfComGroup();

        });
    }

    var getAccountSetting = function(){
        if (isGuest()){
            showSignUpScreen();
        }else{

        $('.TipShadowBox').trigger('click');
        hideSideMenu();
        resetPosition(groupsWindowManager.stageWidth);
        //resetPosition(createGroupWindowManager.stageWidth);
        $("#welcomeMapLayer").css('z-index', '1');
        printAccountSettingScreen();
        $("#" + accountSettingWindowManager.container + "List").animate({
            'margin-left':0
        });

        }
    }

    // print account seting screen
    var kill = 0;
    var UserProfileImg = "";
    function printAccountSettingScreen(){

        var userObject = $('body').data('loggedInUser');
        if (userObject == null){
            showSignUpScreen();
            return false;
        }

      // alert(JSON.stringify(userObject));

        //for a twitter user case
        if (userObject.twitterId != null){
           var facebookName = "Not Logged In";
           var firstName = userObject.name;
           var  lastName = "";
           var UserProfileImg = userObject.profileImg;
           var twitterUserName =  "@" + userObject.name;
           var userEmail = "No Email Provided";

        }

        //for facebook user case
        if (userObject.facebookId != null){
            var facebookName = userObject.name;
            var firstName = userObject.first;
            var  lastName = userObject.last;
            var UserProfileImg = userObject.profileImg;
            var twitterUserName =  "Not Logged In";
            var userEmail = userObject.emailAddress;
        }
        //for joynme user case
        if ((userObject.twitterId == null) && (userObject.facebookId == null)){
            if (userObject.user){
                var facebookName = "Not Logged In";
                var firstName = userObject.user.first;
                var  lastName = userObject.user.last;
                var UserProfileImg = userObject.user.pictureUrl;
                var twitterUserName =  "Not Logged In";
                var userEmail = userObject.user.emailAddress;
            }else{
                var facebookName = "Not Logged In";
                var firstName = userObject.first;
                var  lastName = userObject.last;
                var UserProfileImg = userObject.pictureUrl;
                var twitterUserName =  "Not Logged In";
                var userEmail = userObject.emailAddress;
            }
        }

        var htmlContent = '<div class="row-fluid borderBottom topBarHeader" style="border-bottom: 1px solid #e1e1e1; text-indent: 5px; position: relative"> ' +
                '<div class="wrapper padding5px"> ' +
                '<div><h3 class="padding4px">Account Info</h3></div> <div class="comGroupContainer" id="comGroupDetail"> <div class="row-fluid "> ' +
                '<div class="span2"><img style="margin-left: 0px; margin-top: 11px" src="'+  UserProfileImg +'"></div>' +
                ' <div class="span10" style="border-left: solid 1px #868686"> <div class="span12 padding10px" style="border-bottom: solid 1px #868686">' +firstName+ '</div>' +
                ' <div  style="margin-left:0px;"  class="span12 padding10px" >' +lastName+ '</div> </div> </div> <hr class="dHr"> <div class="row-fluid"> ' +
                '<div class="span12 padding10px">' + userEmail+ '</div></div>' +
                '</div>' +
                ' <h3 class="padding10px">Connected Accounts</h3><div class="comGroupContainer" > ' +
                '<div class="row-fluid padding4px"><div class="span12"> <i class="zocial facebook icon"></i><span class="s">Facebook</span><span class="nameText">' + facebookName  + '</span></div></div>' +
                ' <hr class="dHr"> <div class="row-fluid padding4px "><div class="span12"><i class="zocial twitter icon"></i><span class="s">Twitter</span><span class="nameText">'+ twitterUserName +' </span></div> </div> </div> </div>' +
                '<hr class="hr"><div class="span12"><div class="span7"></div><div class="span5"><div><button id="logOutBtn" class="btn btn-large btn-danger fbLogOut"> Sign out</button> </div></div></div>';
        $('#accountSettingContainer').html(htmlContent);
    }

    //showLayer("#planActivityBtn", "#planActivityLayer", inputFocus);
    showLayer("#planActivityBtn", "#createActivityLayer", calCreateActivitySteps);
    showLayer("#getNotification", "#notificationLayer", calNotifications);
    showLayer("#getAgenda", "#agendaLayer", calAgenda);
    showLayer("#getFavorites", "#favoritesLayer", calFavorites);
    showLayer("#getGroups", "#groupsLayer", calGroups);
    showLayer("#getSupport", "#supportLayer");
    showLayer("#createGroupShowLayer", "#createGroupLayer", createAGroup);
    showLayer("#findGroupBtn", "#findAgroupLayer", findAGroup);
    showLayer("#getAccountSetting", "#accountSettingLayer", getAccountSetting);

    //
    $("#saveActivityLocation").live('click', function () {

        var chosenLocationLat = activityLocation.lat;
        var chosenLocationLng = activityLocation.lng;
        var chosenLocationAddress = $("#searchLocation").val();
        $('#createActivityMapPop').modal('hide');
        //
        var location = new google.maps.LatLng(chosenLocationLat, chosenLocationLng);
        initializeMap(location, "placeHolder");
        $(".chosenLocation").html(chosenLocationAddress).append("<span class='badge badge-info MapPopHandler' style='margin-left: 5px'> Change location</span>");
    });
    //showLayer("#getAccount", "#accountLayer");
    // When clicked Plan an activity
    $("#privateBtn").live('click', function () {
        planedEvent.event.publicEvent = false;
    });
    $("#publicBtn").live('click', function () {
        planedEvent.event.publicEvent = true;
    });
    $(' body ').on('click', ' #planBtn ',  function () {
       // alert("Plan button clicked");
      //  alert(JSON.stringify("token is    "+ JSON.stringify(queryString.token)));
        planedEvent.token = queryString.token;
       // alert("planed event token" + JSON.stringify(planedEvent.token));
        planedEvent.event.latitude = activityLocation.lat;
        planedEvent.event.longitude = activityLocation.lng;
        var activityType = $("#inputActivity").val();
        var startDateTimeValue = $("#startDateTime").val().replace('PM', '').replace('AM', '');
        var endDateTimeValue = $("#endDateTime").val().replace('PM', '').replace('AM', '');
        var eventAddress = $("#searchLocation").val();
        if (validateInput(activityType, startDateTimeValue, endDateTimeValue, eventAddress) == false) {
            //   alert(" please filn the input");
            $("#messageSuccessBox").removeClass('.alert-success');
            showMessageToUser(" Please fill in all fields", "alert-error");
            return false;
        }


        var afterNewActivityTypeCreated = function()
        {
            if (validateInput(activityType, startDateTimeValue, endDateTimeValue, eventAddress) == false) {
                //   alert(" please filn the input");

                showMessageToUser(" Please fill in all fields", "alert-error");
                return false;
            }
            //t4.showToolTip('click');
            var startDateTime = new Date(startDateTimeValue).toString("yyyy-M-d HH:mm:ss");
            var endDateTime = new Date(endDateTimeValue).toString("yyyy-M-d HH:mm:ss");
           //  alert(startDateTime);
            planedEvent.event.start = startDateTime;
            planedEvent.event.end = endDateTime;
            //alert(planedEvent.event.end);
            planedEvent.event.notes = $("#notes").val();
            planedEvent.event.allowInvites = true;
            // alert("planedEvent.event.activityId: " + planedEvent.event.activityId);
            //alert("Logged in " + JSON.stringify($('body').data('loggedInUser')));
            joynMeApiCall('POST', 'event', JSON.stringify(planedEvent), function (localReturnedObject) {
                //console.log(" Object returned after creating an event" + JSON.stringify(apiReturnedObject));
           //         alert("Event Id " + apiReturnedObject.event.id);
                //    alert(" Success");
                // t4.hideShadowBox();

                var newActivityCreatedId = localReturnedObject.event.id;

                $("#inputActivity").val(" ");
                $("#startDateTime").val(" ");
                $("#endDateTime").val(" ");
                $("#searchLocation").val(" ");

                showMessageToUser("Activity Created Successfully", 'alert-success');
                $('[id$="LayerList"]').animate({
                    "margin-left":-$(".screen").width()
                });

                $('[id$="LayerSlider"]').animate({
                    'margin-left':$(window).width()
                }, 'slow', function () {
                    // $("#welcomeMapLayer").css('z-index', '1');
                });
                $("#welcomeMapLayer").css('z-index', 3);
                showActivitiesListScreen(newActivityCreatedId);
                //alert(" event id: " + apiReturnedObject.event.id);
                //alert(" event id: " + newActivityCreatedId);
                sendInvites('event',newActivityCreatedId, fbFriendInvited,TFollowersInvited, groupFriendInvited,gmailContactsInvited,yahooContactsInvited,emailContactsInvited );
                // emptying the planned event object
                planedEvent.event = {};
            });

        }


        addNewActivity(activityType, afterNewActivityTypeCreated);


        // alert("have fun :)");
        // $("#message").hide().html(" <h1 class='badge badge-success'>Have fun</h1>").fadeIn();
        //alert(" After Api Call");
        return false;

    });

    // Add new Activity
    var addNewActivity = function (activityName, callBack) {
        var tokenObject = {'token':queryString.token};
        joynMeApiCall("PUT", "activity/name/" + activityName, JSON.stringify(tokenObject), function (localReturnedObject) {
            //alert(JSON.stringify(apiReturnedObject));
            var activityId = localReturnedObject.activityResult.id;
           // alert("Activity " + activityName + " Id: " + activityId);
            planedEvent.event.activityId = activityId;
            $("#inputActivity").val(activityName);

            if (typeof(callBack) == 'function') {
                callBack();
            }

        });
    };

    $("#addActivityType").live('click', function () {
        //$('#addNewActivityBtn').popover('hide');
        $(this).closest($('[id$="TipContainer"]')).hide();
        $('#createActivityLayerList .TipShadowBox').hide();
        var activityName = $("#activityTypeInput").val();
        addNewActivity(activityName);
    });

    $("#cancelActivityType").live('click', function () {
        // $('#addNewActivityBtn').popover('hide');
        $(this).closest($('[id$="TipContainer"]')).hide();
        $('#createActivityLayerList .TipShadowBox').hide();

    });


    //cancelCreateGroupBtn
    $(' body ').on('click', '#cancelCreateGroupBtn', function(){
        var stageWidth = $("#widget").width();
        $("#createGroupLayer").animate({
            'margin-left': - stageWidth
        }, 'slow');
    });

    $(' body ').on('click', '#backFindAGroup', function(){
        var stageWidth = $("#widget").width();
        $("#findAgroupLayer").animate({
            'margin-left': - stageWidth
        }, 'slow');
    });


    var handleNotificationMapItemClick = function() {
        //alert("event clicked");
        $("#welcomeMapLayer").css('z-index', 1);
        showDetailsAndChatRoom($(this), "id", notificationWindowManager);
        $("#" + notificationWindowManager.container + "LayerSlider").animate({
            'margin-left':notificationWindowManager.layerMargin
        }, "slow", function () {
            //alert(" animation complete");
            $('div[id$="LayerSlider"]').css("margin-left", notificationWindowManager.layerMargin);

            currentMarginValue = parseInt($("#" + notificationWindowManager.container + "LayerSlider").css("margin-left"));
            //alert(currentMarginValue);
        });
    };

    // This selector is used for map items when the notification screen is shown
    // // welcome map during the notification are shown
    $(".notificationMapItem").live('click', handleNotificationMapItemClick);

    // This selector is used when row items are clicked in the notification view
    $(".notification").live('click', handleNotificationItemClick);

    // delete a notification
    $(".deleteANotification").live('click', function () {
        //event.stopPropagation();
        var notificationId = $(this).attr("notitifcation-data");
        //alert(notificationId);
        $("#notification_" + notificationId).css("background-color", "yellow").fadeOut('fast');
        joynMeApiCall("Delete", "notifications/general/id/" + notificationId, JSON.stringify({'token':queryString.token}), function () {
            //joynMeApiCall("PUT",'notifications/general/read/',JSON.stringify(aNotification));
            joynMeApiCall("GET", "notifications/general/count", JSON.stringify(queryString), function (d) {
                printNotificationCount(d);
            });
        });

        $("#notificationLayer").css("z-index", "3").animate({'width':'100%'});
        // alert(" Notification id To delete: " + notificationId);
        return false;
    });

    // click an event in Agenda Attending
    $('.agendaItem').live('click', function () {
        $("#welcomeMapLayer").css('z-index', 1);
        //alert("clicked");
        showDetailsAndChatRoom($(this), 'id', agendaWindowManager);
        $("#" + agendaWindowManager.container + "LayerSlider").animate({
            'margin-left':agendaWindowManager.layerMargin
        }, "slow", function () {
            //alert(" animation complete");
            currentMarginValue = parseInt($("#" + agendaWindowManager.container + "LayerSlider").css("margin-left"));
            //alert(currentMarginValue);
        });
    });
    // Details screen icons actions
    $(".detailListIcon").live('click', function () {
        // alert(eventDetail);
        $(".detailsScreenContent").html(eventDetail);
        $('.attendingListIconSelected').removeClass('attendingListIconSelected').addClass("attendingListIcon");
        $('.mapLocationIconSelected').removeClass('mapLocationIconSelected').addClass("mapLocationIcon");
        $('.weatherIconSelected').removeClass('weatherIconSelected').addClass("weatherIcon");
        $(this).removeClass('detailListIcon').addClass("detailListIconSelected");

    });
    $(".attendingListIcon").live('click', function () {
        $(".detailsScreenContent").html(getAttendingList(eventDataObject));
        //$("#friendsAttendingContainer").append(getAttendingList(eventDataObject));
        $('.mapLocationIconSelected').removeClass('mapLocationIconSelected').addClass("mapLocationIcon");
        $('.detailListIconSelected').removeClass('detailListIconSelected').addClass("detailListIcon");
        $('.weatherIconSelected').removeClass('weatherIconSelected').addClass("weatherIcon");
        $(this).removeClass('attendingListIcon').addClass("attendingListIconSelected");
    });

    $(".weatherIcon").live('click', function () {
        var weatherWidgetUrl;
        var urlProtocol = location.protocol + '//';
        var urlHost = location.host;
        var urlPathname = location.pathname;
        weatherWidgetUrl = urlProtocol + urlHost + "/weather-widget/weather.html"; // production
        // = urlProtocol + urlHost + urlPathname.replace('widgetLayout.html', '') + "/weather-widget/weather.html";  // localhost
        //alert(weatherWidgetUrl);

        $(".detailsScreenContent").html('<iframe src="' + weatherWidgetUrl + '" frameborder="0" width="100%" height="100%"></iframe>');
        // $("#detailsScreenContent").html("weather widget html goes here");
        $('.mapLocationIconSelected').removeClass('mapLocationIconSelected').addClass("mapLocationIcon");
        $('.detailListIconSelected').removeClass('detailListIconSelected').addClass("detailListIcon");
        $('.attendingListIconSelected').removeClass('attendingListIconSelected').addClass("attendingListIcon");
        $(this).removeClass('weatherIcon').addClass("weatherIconSelected");
    });

    $(".mapLocationIcon").live('click', function () {
        //alert( $(this).closest($('[id$="LayerSlider"]')).attr('id'));
        var parentLayer = $(this).closest($('[id$="LayerSlider"]')).attr('id');
        var divId = parentLayer + 'dMap';
        //alert(JSON.stringify(eventDataObject));
        var eventAddress = eventDataObject.event.address;
        var mapTitle = "<div><h4> " + eventAddress + "</h4></div><hr class='hr'>"+ "<div><span class='span4'></span><h1 id='getDirectionsBtn'  class='span4 myBtn btn-success followEventBtn btn'>Get Directions</h1><span class='span4'></span></div>"
        var mapHtml = mapTitle + '<div id="' + divId + '"></div>';
        $("#" + parentLayer + " .detailsScreenContent").html(mapHtml);
        getEventDetailMap(eventDataObject, divId);
        $('.weatherIconSelected').removeClass('weatherIconSelected').addClass("weatherIcon");
        $('.detailListIconSelected').removeClass('detailListIconSelected').addClass("detailListIcon");
        $('.attendingListIconSelected').removeClass('attendingListIconSelected').addClass("attendingListIcon");
        $(this).removeClass('mapLocationIcon').addClass("mapLocationIconSelected");
    });


    // activities auto complete
    // get Activities as json objet
    //alert(" Query string token" + queryString.token);
    $.getJSON(activitiesUrl, function (data) {
        activitiesType = data.activityResultList;
        $.each(activitiesType, function (k) {
            activitiesType[k].label = activitiesType[k].name;
            activitiesType[k].icon = "grayStar.png"
        });
    });

    //
    $(".as-close").live('click', function () {
        var favoriteActivityId = $(this).parent().attr("id").replace('favoriteType', '');
        //alert("#favoriteItem" + favoriteActivityId);
        $("#img" + favoriteActivityId).attr({
            src: 'images/grayStar.png',
            'data-selected' : ''
        });
         unFavorite(favoriteActivityId);

    });


    $('#getDirectionsBtn').live('click',function(){
        var eventAddress = eventDataObject.event.address;

        var info = document.getElementById('info');
        var lat = GeoIP.geoip_latitude();
        var lon = GeoIP.geoip_longitude();

        var startAddress = lat+","+lon;


        window.open('http://maps.google.com/maps?saddr='+lat+','+lon+'&daddr='+eventAddress+'','_blank');

    });


    // search location with google api : auto-complete

    $('#searchLocation').live('click', function () {
        $(this).autocomplete({

            source:function (request, response) {

                if (geocoder == null) {
                    geocoder = new google.maps.Geocoder();
                }
                geocoder.geocode({'address':request.term }, function (results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {

                        var searchLoc = results[0].geometry.location;
                        var lat = results[0].geometry.location.lat();
                        var lng = results[0].geometry.location.lng();
                        var latlng = new google.maps.LatLng(lat, lng);
                        var bounds = results[0].geometry.bounds;

                        geocoder.geocode({'latLng':latlng}, function (results1, status1) {
                            if (status1 == google.maps.GeocoderStatus.OK) {
                                if (results1[1]) {
                                    response($.map(results1, function (loc) {
                                        return {
                                            label:loc.formatted_address,
                                            lat:lat,
                                            lng:lng,
                                            value:loc.formatted_address,
                                            bounds:loc.geometry.bounds
                                        }
                                    }));
                                }
                            }
                        });
                    }
                });
            },
            select:function (event, ui) {
                // alert(JSON.stringify(ui));
                var pos = ui.item.position;
                var lct = ui.item.locType;
                var bounds = ui.item.bounds;
                activityLocation.lat = ui.item.lat;
                activityLocation.lng = ui.item.lng;
                var planLocation = new google.maps.LatLng(ui.item.lat, ui.item.lng);
                var mapOptions = {
                    zoom:15,
                    mapTypeId:google.maps.MapTypeId.ROADMAP,
                    center:planLocation
                };
                // map = new google.maps.Map(document.getElementById("map"), mapOptions);
                if (bounds) {
                    // map.fitBounds(bounds);
                    if (planLocation) {
                        //placeMarker(planLocation, widget.draggableMap);
                        widget.draggableMap.setCenter(planLocation);
                        widget.draggableMarker.setPosition(planLocation);

                    }
                }
                else {
                    placeMarker(planLocation, widget.draggableMap);
                    //widget.draggableMap.setCenter(planLocation);
                    widget.draggableMap.setCenter(planLocation);
                    widget.draggableMarker.setPosition(planLocation);
                }
            }
        });
    });

    /// draggable map

    // draggable map
    // Update current position info.
    // updateMarkerPosition(userLocation.location);
    //
    geocodePosition(userLocation.location);
    initializeDraggableMap(userLocation.location);

    // Add dragging event listeners.
    google.maps.event.addListener(widget.draggableMarker, 'dragstart', function () {
        // updateMarkerAddress('Dragging...');
    });

    google.maps.event.addListener(widget.draggableMarker, 'drag', function () {
        //  updateMarkerStatus('Dragging........');
        // updateMarkerPosition(widget.draggableMarker.getPosition());
    });

    google.maps.event.addListener(widget.draggableMarker, 'dragend', function () {
        // updateMarkerStatus('Drag ended');
        geocodePosition(widget.draggableMarker.getPosition());

    });

    //  reset layers position
    function resetPosition(stageWidth) {
        $(".pilContainer, .pilContainerGroup, .pilContainerGmail, .pilContainerYahoo").remove();
        fbFriendInvited = [];
        $(".genericLayer").css('z-index', '0');
        $('[id$="LayerList"]').animate({
            "margin-left":-$(".screen").width()
        });
        //alert(stageWidth);
        // $(".leftLayer").animate({
        //   'margin-left' : '-100%'
        //});
        $('[id$="LayerSlider"]').animate({
            'margin-left':$(window).width()
        }, 'slow', function () {
            // $("#welcomeMapLayer").css('z-index', '1');
        });
    }

    // look for any notifications passed to us in a cookie
    setTimeout(function(){detectNotificationCookie(true);}, 1000);
     function populateMap(eventsObject, selector){


         $.each( eventsObject , function(k){
             eventsObject[k].latLng = [eventsObject[k].latitude, eventsObject[k].longitude ] ;
         });
         $(selector).width('60%').height('400px').css('margin-top','100px').gmap3({

             map:{
                 options:{
                     center:[37.47719245034966, -122.1967299097424,],
                     zoom:6
                    // mapTypeId:google.maps.MapTypeId.TERRAIN
                 }
             },
             marker:{
                 values: eventsObject ,
                 callback: function(){
                     $('img').css('max-width', 'none;');
                 },
                 events:{ // events trigged by markers
                     click:function () {
                         alert("Here is the default click event");
                     }
                 },
                 options: {
                     icon: new google.maps.MarkerImage("http://joynme.com/hassan/w/images/marker.png")
                 },
                 cluster:{
                     radius:100,
                     events:{ // events trigged by clusters
                         mouseover:function (cluster) {
                             $(cluster.main.getDOMElement()).css("border", "1px solid red");
                         },
                         mouseout:function (cluster) {
                             $(cluster.main.getDOMElement()).css("border", "0px");
                         }
                     },
                     0:{
                         content:"<div class='cluster cluster-1'>CLUSTER_COUNT</div>",
                         width:53,
                         height:52
                     },
                     20:{
                         content:"<div class='cluster cluster-2'>CLUSTER_COUNT</div>",
                         width:56,
                         height:55
                     },
                     50:{
                         content:"<div class='cluster cluster-3'>CLUSTER_COUNT</div>",
                         width:66,
                         height:65
                     }
                 }
             }
         });
     }

    });
//});

</script>
<style type="text/css">

</style>
</head>
<body>
<div class="container-fluid widgetSize" id="widget">


    <div class="container-fluid" id="topNavBar" style="display: none">
        <div><span class="sliderToggle" style="display: none; float: left"></span></div>
        <div><a href=""><h1 class="span2" id="logo">Joynme</h1></a></div>
       <!-- <div id="userProfile"></div>-->
    </div>

    <div class="row-fluid" id="contentBox">
        <div id="sideMenu" class="span2">
            <ul id="sideMenuUl">
                <li>
                    <div class="btn-success" id="planActivityBtn">Plan Activity</div>
                </li>


                <li>
                    <button class="getEvents b"><i class="activitiesIcon"></i>
                        <span>Activities </span></button>
                </li>
                <li>
                    <button id="getNotification" class="b"><i class="sideMenuIcon notificationIcon"> 0 </i>
                        <span class="listTitle"> Notifications </span></button>
                </li>

                <li>
                    <button id="getAgenda" class="b"><i class="sideMenuIcon calender"></i>
                        <span> My Agenda </span></button>
                </li>
                <li >
                    <button id="getGroups" class="b"><i class="sideMenuIcon groupIcon"></i>
                        <span> Groups </span></button>
                </li>
                <li>
                    <button id="getFavorites" class="b"><i class="sideMenuIcon starIcon"></i>
                        <span> Favorites </span></button>
                </li>
                <a href="http://www.joynme.com/contact" target="_blank">

                <li style="outline: none">
                    <button id="getSupport" class="b"><i class="sideMenuIcon supportIcon"> </i>
                        <span> Support </span></button>
                </li>
                </a>

                <li>
                    <button  id="getSettings" class="b"><i class="sideMenuIcon settingsIcon"> </i>
                        <span> Settings </span></button>
                </li>

                <li>
                    <button style="width:128px;height:35px; background: transparent; display: inline-block;border: none;text-align: left; padding: 0px" id="getAccountSetting">
                        <div id="userProfile"></div>
                    </button>

                </li>
                <a href="http://www.joynme.com" target="_blank">
                    <li style="outline: none">

                        <div class="poweredByLogo"></div>
                    </li>
                </a>

               <!-- <li>
                </li>
                <!-- <li id="getAccount"></span><i class="sideMenuIcon accountIcon"> </i>
             <span class="listTitle"> Account </span></span></li>-->
            </ul>

        </div>

        <!---    starting the stage or the view box for the map -->
        <div id="stage" class="container-fluid">
            <div id="messageSuccessBox" class="alert"></div>

            <div class="centerStage fullLayer insideStage fixedLayer" id="welcomeMapLayer">

                <div id="mapCanvas"></div>
            </div>
            <div id="eventLayer" class="genericLayer leftLayer"></div>
            <div id="notificationLayer" class="genericLayer leftLayer"></div>
            <div id="agendaLayer" class="genericLayer leftLayer"></div>
            <div id="createActivityLayer" class="genericLayer leftLayer"></div>
            <!--<div id="planActivityLayer" class="genericLayer leftLayer"> </div>-->
            <div id="favoritesLayer" class="genericLayer leftLayer"></div>
            <div id="groupsLayer" class="genericLayer leftLayer"></div>
            <div id="createGroupLayer" class="genericLayer leftLayer"></div>
            <div id="findAgroupLayer" class="genericLayer leftLayer"></div>
            <div id="accountSettingLayer" class="genericLayer leftLayer"></div>

        </div>


    </div>


</div>
</div>
</div>


<script type="text/javascript">

    $(window).resize(function () {

    });
</script>

<!--
<hr>
<hr>
<div id="windowSize"></div>
<div id="stageSize"></div>
<div id="sideMenuSize"></div>
<div id="paneSize"></div>-->


<!--<div id="infoPanel">
    <b>Marker status:</b>

    <div id="markerStatus"><i>Click and drag the marker.</i></div>
    <b>Current position:</b>

    <div id="info"></div>
    <b>Closest matching address:</b>

    <div id="address"></div>
    <div id="mapDetailCanvas"></div>
    <div id="b"></div>
</div>-->
<!-- Button to trigger modal -->
<!--<a href="#joynmeLogInPop" role="button" class="btn" data-toggle="modal">Launch demo modal :)</a>-->

<!-- Modal -->

<div id="createActivityMapPop" class="modal noVisibility" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
        <h3 id="myModalLabel">Choose Location</h3>
    </div>
    <div class="modal-body">
        <div class='screen260'>
            <form>
                <div class='row-fluid'>
                    <div class='span12'>
                        <input type="text" class="span12" id="searchLocation" placeholder="Search By Location"> <span
                            class="help-block">Drag and drop the red pin on the map.</span>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        <div id="canvas2">
                            <div id="draggableMapCanvas"></div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
            <input type="button" class="btn btn-primary" id="saveActivityLocation" value="Save Location">
        </div>
    </div>
</div>
<!--- Log in with joynMe account modal-->
<div id="joynmeLogInPop" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
        <h3>Log in Screen</h3>
    </div>
    <div class="modal-body">
        <div id="joynMeLogInError"></div>
        <div id='screenBody'>
            <form class="form-horizontal">
                <div class='control-group'>
                    <label class="control-label" for="email">Email</label>

                    <div class="controls">
                        <input type="text" class="input-xlarge" id="email" placeholder="Email">
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="joynmeUserP">Password</label>

                    <div class="controls">
                        <input type="password" class="input-xlarge" id="joynmeUserP" placeholder="Password">
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <div id="screenFooter">
                <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                <input type="button" class="btn btn-primary" id="logIn" value="Log in">

                <p style="float: left; font-weight: 500"><a href="#" id="joynmeSignUpBtn"> Sign up for JoynMe</a></p>
            </div>


        </div>

    </div>
</div>

<!--
<div class="span12"><div class="span4"></div><div class="span4"><button class="btn" id="removeAccess" onclick="removeEventListeners();"> Remove Access</button></div><div class="span4"></div></div>
-->

<script type="text/javascript">
    var clientUrl = window.top.location.href;
    $("body").on('click', '#signInTwitter', function(){
        var positionX = (screen.width/2)-300;
        var twitterSignInPopUp = window.open('','','left= ' + positionX +' top= 0 height=400,width=600');
        //twitterSignInPopUp.moveTo(screen.width/2-300,0);

        $.ajax({
            type: "POST",
            url:"twitter/signIn.php?clientUrl=" + clientUrl,
            success:function(result){
                var urls = $.parseJSON(result);
                var authrUrl = urls[0].authUrl;
                //console.log(authrUrl);
                twitterSignInPopUp.location.href= authrUrl;
                twitterSignInPopUp.focus();

            }});
    });
</script>

<script type="text/javascript" src="js/jquery.smartbanner.js"></script>
<script type="text/javascript" src="js/mobile_banner_always.js"></script>
 <script type="text/javascript">

 </script>
<div id='mapContainer'></div>


</body>
</html>



